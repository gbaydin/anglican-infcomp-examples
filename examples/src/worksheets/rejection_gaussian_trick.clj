;; gorilla-repl.fileformat = 1

;; **
;;; # Rejection Sampling Gaussian (with trace-shortening trick)
;; **

;; @@
(ns worksheets.rejection-gaussian-trick
  (:require [anglican.runtime :refer :all]
            [anglican.emit :refer [defquery defm]]
            [anglican.stat :as stat]
            [anglican.infcomp.zmq :as zmq]
            [anglican.inference :refer [infer]]
            [anglican.infcomp.prior :as prior]
            [gorilla-plot.core :as plt]
            anglican.infcomp.csis
            anglican.importance
            anglican.infcomp.core))

(anglican.infcomp.core/reset-infcomp-addressing-scheme!)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>#function[anglican.infcomp.core/reset-infcomp-addressing-scheme!$fn--26896$fn--26897]</span>","value":"#function[anglican.infcomp.core/reset-infcomp-addressing-scheme!$fn--26896$fn--26897]"}
;; <=

;; **
;;; ## Model
;; **

;; @@
(defm rejection-sample
  [unnormalized-target-density unnormalized-proposal-density proposal-sampler bound]
  (loop []
    (let [x (proposal-sampler)
          u (sample "u" (uniform-continuous 0 1))
          accept (< u (/ (unnormalized-target-density x)
                         (* (unnormalized-proposal-density x)
                            bound)))]
      (if accept x (recur)))))

(defm rejection-sample-gaussian
  [target-mean target-sd proposal-mean proposal-sd]
  (if (>= target-sd proposal-sd)
    (println "Target standard deviation must be < proposal standard deviation.")
    (let [unnormalized-target-density (fn [x] (exp (observe* (normal target-mean target-sd) x)))
          unnormalized-proposal-density (fn [x] (exp (observe* (normal proposal-mean proposal-sd) x)))
          proposal-sampler (fn [] (sample "x" (normal proposal-mean proposal-sd)))
          target-var (* target-sd target-sd)
          proposal-var (* proposal-sd proposal-sd)
          maximizer (/ (- (* proposal-mean target-var) (* target-mean proposal-var))
                       (- target-var proposal-var))
          bound (/ (unnormalized-target-density maximizer) (unnormalized-proposal-density maximizer))]
      (rejection-sample unnormalized-target-density unnormalized-proposal-density proposal-sampler bound))))

(defquery q []
  (rejection-sample-gaussian 0 1 0 2))

(def num-particles 10000)
(def is-states (take num-particles (infer :importance q [])))
(def posterior-plot (plt/plot #(Math/exp (observe* (normal 0 1) %)) [-3 3]))
(plt/compose
  posterior-plot
  (plt/histogram (map first (stat/empirical-distribution (stat/collect-results is-states))) :normalize :probability-density :bins 30))
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"3ebce99e-7cfd-491b-9177-6f9951650818","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"3ebce99e-7cfd-491b-9177-6f9951650818","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"3ebce99e-7cfd-491b-9177-6f9951650818","values":[{"x":-3,"y":0.004431848411938009},{"x":-2.9400000013411045,"y":0.005296343844428344},{"x":-2.880000002682209,"y":0.006306726347547964},{"x":-2.8200000040233135,"y":0.007482872440881806},{"x":-2.760000005364418,"y":0.008846454267258452},{"x":-2.7000000067055225,"y":0.010420934625752505},{"x":-2.640000008046627,"y":0.012231526091442494},{"x":-2.5800000093877316,"y":0.014305108647674996},{"x":-2.520000010728836,"y":0.016670100386677104},{"x":-2.4600000120699406,"y":0.019356276157009356},{"x":-2.400000013411045,"y":0.022394529574041172},{"x":-2.3400000147521496,"y":0.025816574580398738},{"x":-2.280000016093254,"y":0.029654583759236897},{"x":-2.2200000174343586,"y":0.03394076186879655},{"x":-2.160000018775463,"y":0.03870685457769908},{"x":-2.1000000201165676,"y":0.04398359412234937},{"x":-2.040000021457672,"y":0.04980008555513914},{"x":-1.9800000227987766,"y":0.05618313936767242},{"x":-1.9200000241398811,"y":0.06315655850798227},{"x":-1.8600000254809856,"y":0.07074039010426844},{"x":-1.8000000268220901,"y":0.07895015448919936},{"x":-1.7400000281631947,"y":0.08779606630855066},{"x":-1.6800000295042992,"y":0.09728226450945571},{"x":-1.6200000308454037,"y":0.10740606974645023},{"x":-1.5600000321865082,"y":0.11815728912679202},{"x":-1.5000000335276127,"y":0.12951758915226816},{"x":-1.4400000348687172,"y":0.14145995812199927},{"x":-1.3800000362098217,"y":0.15394827906990657},{"x":-1.3200000375509262,"y":0.16693703346710842},{"x":-1.2600000388920307,"y":0.18037115438817936},{"x":-1.2000000402331352,"y":0.19418604560795646},{"x":-1.1400000415742397,"y":0.2083077801744371},{"x":-1.0800000429153442,"y":0.2226534884320895},{"x":-1.0200000442564487,"y":0.23713194131486914},{"x":-0.9600000455975533,"y":0.2516443300827255},{"x":-0.9000000469386578,"y":0.2660852386580388},{"x":-0.8400000482797623,"y":0.28034379947027716},{"x":-0.7800000496208668,"y":0.29430501839746187},{"x":-0.7200000509619713,"y":0.30785124917398365},{"x":-0.6600000523030758,"y":0.3208637926949442},{"x":-0.6000000536441803,"y":0.33322459216646294},{"x":-0.5400000549852848,"y":0.34481799120097834},{"x":-0.4800000563263893,"y":0.3555325188935821},{"x":-0.4200000576674938,"y":0.36526266377536454},{"x":-0.3600000590085983,"y":0.3739105974301092},{"x":-0.30000006034970284,"y":0.38138780855553106},{"x":-0.24000006169080734,"y":0.3876166093860418},{"x":-0.18000006303191185,"y":0.3925314786668664},{"x":-0.12000006437301636,"y":0.39608020873402994},{"x":-0.060000065714120865,"y":0.3982248286254664},{"x":-6.705522537231445E-8,"y":0.3989422804014318},{"x":0.05999993160367012,"y":0.398224831829833},{"x":0.11999993026256561,"y":0.39608021510824926},{"x":0.1799999289214611,"y":0.3925314881425295},{"x":0.2399999275803566,"y":0.3876166218620669},{"x":0.2999999262392521,"y":0.38138782389995834},{"x":0.3599999248981476,"y":0.37391061548242394},{"x":0.4199999235570431,"y":0.3652626843492917},{"x":0.47999992221593857,"y":0.35553254178028304},{"x":0.5399999208748341,"y":0.3448180161725746},{"x":0.5999999195337296,"y":0.3332246189798036},{"x":0.659999918192625,"y":0.32086382109552875},{"x":0.7199999168515205,"y":0.3078512788999547},{"x":0.779999915510416,"y":0.2943050491835782},{"x":0.8399999141693115,"y":0.2803438310517862},{"x":0.899999912828207,"y":0.26608527077437016},{"x":0.9599999114871025,"y":0.251644362480936},{"x":1.019999910145998,"y":0.23713197375277958},{"x":1.0799999088048935,"y":0.22265352068106362},{"x":1.139999907463789,"y":0.20830781202176413},{"x":1.1999999061226845,"y":0.194186076858812},{"x":1.25999990478158,"y":0.1803711848671489},{"x":1.3199999034404755,"y":0.16693706301927141},{"x":1.379999902099371,"y":0.15394830756148942},{"x":1.4399999007582664,"y":0.1414599854406139},{"x":1.499999899417162,"y":0.1295176152067636},{"x":1.5599998980760574,"y":0.11815731384675265},{"x":1.619999896734953,"y":0.10740609308138008},{"x":1.6799998953938484,"y":0.09728228642769247},{"x":1.739999894052744,"y":0.08779608679595646},{"x":1.7999998927116394,"y":0.07895017354767467},{"x":1.859999891370535,"y":0.07074040775013786},{"x":1.9199998900294304,"y":0.0631565747702967},{"x":1.9799998886883259,"y":0.056183154286471436},{"x":2.0399998873472214,"y":0.04980009917971302},{"x":2.099999886006117,"y":0.04398360650953607},{"x":2.1599998846650124,"y":0.03870686579024687},{"x":2.219999883323908,"y":0.03394077197381796},{"x":2.2799998819828033,"y":0.029654592826774354},{"x":2.339999880641699,"y":0.02581658268211737},{"x":2.3999998793005943,"y":0.022394536782059264},{"x":2.45999987795949,"y":0.01935628254287241},{"x":2.5199998766183853,"y":0.016670106020477325},{"x":2.579999875277281,"y":0.014305113597314317},{"x":2.6399998739361763,"y":0.012231530422034433},{"x":2.699999872595072,"y":0.010420938399154945},{"x":2.7599998712539673,"y":0.008846457541728418},{"x":2.8199998699128628,"y":0.00748287527084081},{"x":2.8799998685717583,"y":0.006306728783446376},{"x":2.9399998672306538,"y":0.005296345932696189},{"x":2.9999998658895493,"y":0.004431850195009893}]},{"name":"1276f38a-312d-4b9c-91ef-e367eef19f47","values":[{"x":-3.601391442169507,"y":0},{"x":-3.353165980538311,"y":4.028595589785887E-4},{"x":-3.1049405189071155,"y":0.0028200169128501213},{"x":-2.85671505727592,"y":0.0036257360308072986},{"x":-2.6084895956447243,"y":0.007251472061614597},{"x":-2.3602641340135286,"y":0.019740118389950847},{"x":-2.112038672382333,"y":0.03182590515930851},{"x":-1.8638132107511376,"y":0.061234652964745485},{"x":-1.6155877491199422,"y":0.08178049047265351},{"x":-1.3673622874887468,"y":0.1357636713757844},{"x":-1.1191368258575514,"y":0.19417830742767977},{"x":-0.870911364226356,"y":0.24775862877183208},{"x":-0.6226859025951605,"y":0.2920731802594768},{"x":-0.3744604409639651,"y":0.36579647955255856},{"x":-0.12623497933276961,"y":0.3915794913271882},{"x":0.12199048229842585,"y":0.4080967332453104},{"x":0.3702159439296213,"y":0.3823137214706807},{"x":0.6184414055608167,"y":0.3343734339522286},{"x":0.8666668671920121,"y":0.29046174202356245},{"x":1.1148923288232075,"y":0.2320471059716671},{"x":1.363117790454403,"y":0.18732969492504375},{"x":1.6113432520855984,"y":0.13374937358089145},{"x":1.8595687137167938,"y":0.09104626032916105},{"x":2.107794175347989,"y":0.06526324855453138},{"x":2.356019636979185,"y":0.03786879854398734},{"x":2.6042450986103804,"y":0.011682927210379073},{"x":2.852470560241576,"y":0.00966862941548613},{"x":3.1006960218727717,"y":0.004028595589785887},{"x":3.3489214835039673,"y":0.0024171573538715324},{"x":3.597146945135163,"y":0.0012085786769357662},{"x":3.8453724067663586,"y":0.0012085786769357662},{"x":4.093597868397554,"y":0}]}],"marks":[{"type":"line","from":{"data":"3ebce99e-7cfd-491b-9177-6f9951650818"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"1276f38a-312d-4b9c-91ef-e367eef19f47"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"3ebce99e-7cfd-491b-9177-6f9951650818\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"3ebce99e-7cfd-491b-9177-6f9951650818\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"3ebce99e-7cfd-491b-9177-6f9951650818\", :values ({:x -3, :y 0.004431848411938009} {:x -2.9400000013411045, :y 0.005296343844428344} {:x -2.880000002682209, :y 0.006306726347547964} {:x -2.8200000040233135, :y 0.007482872440881806} {:x -2.760000005364418, :y 0.008846454267258452} {:x -2.7000000067055225, :y 0.010420934625752505} {:x -2.640000008046627, :y 0.012231526091442494} {:x -2.5800000093877316, :y 0.014305108647674996} {:x -2.520000010728836, :y 0.016670100386677104} {:x -2.4600000120699406, :y 0.019356276157009356} {:x -2.400000013411045, :y 0.022394529574041172} {:x -2.3400000147521496, :y 0.025816574580398738} {:x -2.280000016093254, :y 0.029654583759236897} {:x -2.2200000174343586, :y 0.03394076186879655} {:x -2.160000018775463, :y 0.03870685457769908} {:x -2.1000000201165676, :y 0.04398359412234937} {:x -2.040000021457672, :y 0.04980008555513914} {:x -1.9800000227987766, :y 0.05618313936767242} {:x -1.9200000241398811, :y 0.06315655850798227} {:x -1.8600000254809856, :y 0.07074039010426844} {:x -1.8000000268220901, :y 0.07895015448919936} {:x -1.7400000281631947, :y 0.08779606630855066} {:x -1.6800000295042992, :y 0.09728226450945571} {:x -1.6200000308454037, :y 0.10740606974645023} {:x -1.5600000321865082, :y 0.11815728912679202} {:x -1.5000000335276127, :y 0.12951758915226816} {:x -1.4400000348687172, :y 0.14145995812199927} {:x -1.3800000362098217, :y 0.15394827906990657} {:x -1.3200000375509262, :y 0.16693703346710842} {:x -1.2600000388920307, :y 0.18037115438817936} {:x -1.2000000402331352, :y 0.19418604560795646} {:x -1.1400000415742397, :y 0.2083077801744371} {:x -1.0800000429153442, :y 0.2226534884320895} {:x -1.0200000442564487, :y 0.23713194131486914} {:x -0.9600000455975533, :y 0.2516443300827255} {:x -0.9000000469386578, :y 0.2660852386580388} {:x -0.8400000482797623, :y 0.28034379947027716} {:x -0.7800000496208668, :y 0.29430501839746187} {:x -0.7200000509619713, :y 0.30785124917398365} {:x -0.6600000523030758, :y 0.3208637926949442} {:x -0.6000000536441803, :y 0.33322459216646294} {:x -0.5400000549852848, :y 0.34481799120097834} {:x -0.4800000563263893, :y 0.3555325188935821} {:x -0.4200000576674938, :y 0.36526266377536454} {:x -0.3600000590085983, :y 0.3739105974301092} {:x -0.30000006034970284, :y 0.38138780855553106} {:x -0.24000006169080734, :y 0.3876166093860418} {:x -0.18000006303191185, :y 0.3925314786668664} {:x -0.12000006437301636, :y 0.39608020873402994} {:x -0.060000065714120865, :y 0.3982248286254664} {:x -6.705522537231445E-8, :y 0.3989422804014318} {:x 0.05999993160367012, :y 0.398224831829833} {:x 0.11999993026256561, :y 0.39608021510824926} {:x 0.1799999289214611, :y 0.3925314881425295} {:x 0.2399999275803566, :y 0.3876166218620669} {:x 0.2999999262392521, :y 0.38138782389995834} {:x 0.3599999248981476, :y 0.37391061548242394} {:x 0.4199999235570431, :y 0.3652626843492917} {:x 0.47999992221593857, :y 0.35553254178028304} {:x 0.5399999208748341, :y 0.3448180161725746} {:x 0.5999999195337296, :y 0.3332246189798036} {:x 0.659999918192625, :y 0.32086382109552875} {:x 0.7199999168515205, :y 0.3078512788999547} {:x 0.779999915510416, :y 0.2943050491835782} {:x 0.8399999141693115, :y 0.2803438310517862} {:x 0.899999912828207, :y 0.26608527077437016} {:x 0.9599999114871025, :y 0.251644362480936} {:x 1.019999910145998, :y 0.23713197375277958} {:x 1.0799999088048935, :y 0.22265352068106362} {:x 1.139999907463789, :y 0.20830781202176413} {:x 1.1999999061226845, :y 0.194186076858812} {:x 1.25999990478158, :y 0.1803711848671489} {:x 1.3199999034404755, :y 0.16693706301927141} {:x 1.379999902099371, :y 0.15394830756148942} {:x 1.4399999007582664, :y 0.1414599854406139} {:x 1.499999899417162, :y 0.1295176152067636} {:x 1.5599998980760574, :y 0.11815731384675265} {:x 1.619999896734953, :y 0.10740609308138008} {:x 1.6799998953938484, :y 0.09728228642769247} {:x 1.739999894052744, :y 0.08779608679595646} {:x 1.7999998927116394, :y 0.07895017354767467} {:x 1.859999891370535, :y 0.07074040775013786} {:x 1.9199998900294304, :y 0.0631565747702967} {:x 1.9799998886883259, :y 0.056183154286471436} {:x 2.0399998873472214, :y 0.04980009917971302} {:x 2.099999886006117, :y 0.04398360650953607} {:x 2.1599998846650124, :y 0.03870686579024687} {:x 2.219999883323908, :y 0.03394077197381796} {:x 2.2799998819828033, :y 0.029654592826774354} {:x 2.339999880641699, :y 0.02581658268211737} {:x 2.3999998793005943, :y 0.022394536782059264} {:x 2.45999987795949, :y 0.01935628254287241} {:x 2.5199998766183853, :y 0.016670106020477325} {:x 2.579999875277281, :y 0.014305113597314317} {:x 2.6399998739361763, :y 0.012231530422034433} {:x 2.699999872595072, :y 0.010420938399154945} {:x 2.7599998712539673, :y 0.008846457541728418} {:x 2.8199998699128628, :y 0.00748287527084081} {:x 2.8799998685717583, :y 0.006306728783446376} {:x 2.9399998672306538, :y 0.005296345932696189} {:x 2.9999998658895493, :y 0.004431850195009893})} {:name \"1276f38a-312d-4b9c-91ef-e367eef19f47\", :values ({:x -3.601391442169507, :y 0} {:x -3.353165980538311, :y 4.028595589785887E-4} {:x -3.1049405189071155, :y 0.0028200169128501213} {:x -2.85671505727592, :y 0.0036257360308072986} {:x -2.6084895956447243, :y 0.007251472061614597} {:x -2.3602641340135286, :y 0.019740118389950847} {:x -2.112038672382333, :y 0.03182590515930851} {:x -1.8638132107511376, :y 0.061234652964745485} {:x -1.6155877491199422, :y 0.08178049047265351} {:x -1.3673622874887468, :y 0.1357636713757844} {:x -1.1191368258575514, :y 0.19417830742767977} {:x -0.870911364226356, :y 0.24775862877183208} {:x -0.6226859025951605, :y 0.2920731802594768} {:x -0.3744604409639651, :y 0.36579647955255856} {:x -0.12623497933276961, :y 0.3915794913271882} {:x 0.12199048229842585, :y 0.4080967332453104} {:x 0.3702159439296213, :y 0.3823137214706807} {:x 0.6184414055608167, :y 0.3343734339522286} {:x 0.8666668671920121, :y 0.29046174202356245} {:x 1.1148923288232075, :y 0.2320471059716671} {:x 1.363117790454403, :y 0.18732969492504375} {:x 1.6113432520855984, :y 0.13374937358089145} {:x 1.8595687137167938, :y 0.09104626032916105} {:x 2.107794175347989, :y 0.06526324855453138} {:x 2.356019636979185, :y 0.03786879854398734} {:x 2.6042450986103804, :y 0.011682927210379073} {:x 2.852470560241576, :y 0.00966862941548613} {:x 3.1006960218727717, :y 0.004028595589785887} {:x 3.3489214835039673, :y 0.0024171573538715324} {:x 3.597146945135163, :y 0.0012085786769357662} {:x 3.8453724067663586, :y 0.0012085786769357662} {:x 4.093597868397554, :y 0})}), :marks ({:type \"line\", :from {:data \"3ebce99e-7cfd-491b-9177-6f9951650818\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"1276f38a-312d-4b9c-91ef-e367eef19f47\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(def prior-mean 0)
(def prior-std 1)
(def observation-std 0.1)

(defquery rejection-gaussian-trick [obs]
  (let [mean (rejection-sample-gaussian prior-mean prior-std prior-mean (* 1.5 prior-std))
        std observation-std]
    (observe (normal mean std) obs)
    mean))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.rejection-gaussian-trick/rejection-gaussian-trick</span>","value":"#'worksheets.rejection-gaussian-trick/rejection-gaussian-trick"}
;; <=

;; **
;;; ## Inference Compilation
;; **

;; @@
(defn combine-observes-fn [observes]
  (:value (first observes)))

(defn combine-samples-fn [samples]
  (take-last 2 samples))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.rejection-gaussian-trick/combine-samples-fn</span>","value":"#'worksheets.rejection-gaussian-trick/combine-samples-fn"}
;; <=

;; @@
(def replier (zmq/start-replier rejection-gaussian-trick [nil] combine-observes-fn :combine-samples-fn combine-samples-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.rejection-gaussian-trick/replier</span>","value":"#'worksheets.rejection-gaussian-trick/replier"}
;; <=

;; @@
(zmq/stop-replier replier)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;ZMQ connection terminated.&quot;</span>","value":"\"ZMQ connection terminated.\""}
;; <=

;; **
;;; ## Inference
;; **

;; @@
(defn posterior-mean-std [prior-mean prior-std observation-std test-observations]
  (let [prior-variance (* prior-std prior-std)
        observation-variance (* observation-std observation-std)
        num-observations (count test-observations)
        posterior-mean (+ (/ (* observation-variance prior-mean)
                              (+ (* num-observations prior-variance) observation-variance))
                           (/ (* num-observations prior-variance (/ (reduce + test-observations) num-observations))
                              (+ (* num-observations prior-variance) observation-variance)))
        posterior-variance (/ 1 (+ (/ 1 prior-variance) (/ num-observations observation-variance)))]
    [posterior-mean (Math/sqrt posterior-variance)]))

(def test-observation 2.3)
(def posterior-dist (apply normal (posterior-mean-std prior-mean prior-std observation-std [test-observation])))
(def posterior-plot (plt/plot #(Math/exp (observe* posterior-dist %)) [-3 3]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.rejection-gaussian-trick/posterior-plot</span>","value":"#'worksheets.rejection-gaussian-trick/posterior-plot"}
;; <=

;; @@
(def num-particles 100)
(def csis-states (take num-particles (infer :csis rejection-gaussian-trick [test-observation])))
(plt/compose
  posterior-plot
  (plt/histogram (repeatedly 1000 #(sample* (categorical (vec (stat/empirical-distribution (stat/collect-results csis-states)))))) :normalize :probability-density))
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec","values":[{"x":-3,"y":0.0},{"x":-2.9400000013411045,"y":0.0},{"x":-2.880000002682209,"y":0.0},{"x":-2.8200000040233135,"y":0.0},{"x":-2.760000005364418,"y":0.0},{"x":-2.7000000067055225,"y":0.0},{"x":-2.640000008046627,"y":0.0},{"x":-2.5800000093877316,"y":0.0},{"x":-2.520000010728836,"y":0.0},{"x":-2.4600000120699406,"y":0.0},{"x":-2.400000013411045,"y":0.0},{"x":-2.3400000147521496,"y":0.0},{"x":-2.280000016093254,"y":0.0},{"x":-2.2200000174343586,"y":0.0},{"x":-2.160000018775463,"y":0.0},{"x":-2.1000000201165676,"y":0.0},{"x":-2.040000021457672,"y":0.0},{"x":-1.9800000227987766,"y":0.0},{"x":-1.9200000241398811,"y":0.0},{"x":-1.8600000254809856,"y":0.0},{"x":-1.8000000268220901,"y":0.0},{"x":-1.7400000281631947,"y":0.0},{"x":-1.6800000295042992,"y":0.0},{"x":-1.6200000308454037,"y":0.0},{"x":-1.5600000321865082,"y":4.4E-323},{"x":-1.5000000335276127,"y":4.9113798103E-313},{"x":-1.4400000348687172,"y":3.574780202683354E-303},{"x":-1.3800000362098217,"y":1.8087798075632448E-293},{"x":-1.3200000375509262,"y":6.362277264443301E-284},{"x":-1.2600000388920307,"y":1.5557149147154005E-274},{"x":-1.2000000402331352,"y":2.644465908450867E-265},{"x":-1.1400000415742397,"y":3.1249024413932006E-256},{"x":-1.0800000429153442,"y":2.5669977469695233E-247},{"x":-1.0200000442564487,"y":1.4659023636055675E-238},{"x":-0.9600000455975533,"y":5.819358815166062E-230},{"x":-0.9000000469386578,"y":1.6059638332043679E-221},{"x":-0.8400000482797623,"y":3.080966091073537E-213},{"x":-0.7800000496208668,"y":4.108928743782036E-205},{"x":-0.7200000509619713,"y":3.809437342210934E-197},{"x":-0.6600000523030758,"y":2.4551814429930886E-189},{"x":-0.6000000536441803,"y":1.1000106365270637E-181},{"x":-0.5400000549852848,"y":3.426105323550485E-174},{"x":-0.4800000563263893,"y":7.418140732437264E-167},{"x":-0.4200000576674938,"y":1.1165545874443118E-159},{"x":-0.3600000590085983,"y":1.168302714230096E-152},{"x":-0.30000006034970284,"y":8.498090358137434E-146},{"x":-0.24000006169080734,"y":4.297123512648931E-139},{"x":-0.18000006303191185,"y":1.5105143747621218E-132},{"x":-0.12000006437301636,"y":3.691156182843066E-126},{"x":-0.060000065714120865,"y":6.270331682802175E-120},{"x":-6.705522537231445E-8,"y":7.404728517709424E-114},{"x":0.05999993160367012,"y":6.078806230830808E-108},{"x":0.11999993026256561,"y":3.4691093772710382E-102},{"x":0.1799999289214611,"y":1.3762845015356378E-96},{"x":0.2399999275803566,"y":3.795674647579944E-91},{"x":0.2999999262392521,"y":7.277132329850067E-86},{"x":0.3599999248981476,"y":9.698891457036999E-81},{"x":0.4199999235570431,"y":8.986166459405543E-76},{"x":0.47999992221593857,"y":5.7878511394684175E-71},{"x":0.5399999208748341,"y":2.5914974138440473E-66},{"x":0.5999999195337296,"y":8.066306873558855E-62},{"x":0.659999918192625,"y":1.7453769414996687E-57},{"x":0.7199999168515205,"y":2.625392628171194E-53},{"x":0.779999915510416,"y":2.74530007684044E-49},{"x":0.8399999141693115,"y":1.9956111253979068E-45},{"x":0.899999912828207,"y":1.0084457594385378E-41},{"x":0.9599999114871025,"y":3.5425803158997096E-38},{"x":1.019999910145998,"y":8.651220865755213E-35},{"x":1.0799999088048935,"y":1.4686747475789843E-31},{"x":1.139999907463789,"y":1.7332626920942418E-28},{"x":1.1999999061226845,"y":1.4219806410548192E-25},{"x":1.25999990478158,"y":8.109862896734052E-23},{"x":1.3199999034404755,"y":3.215317571586265E-20},{"x":1.379999902099371,"y":8.861857639885287E-18},{"x":1.4399999007582664,"y":1.6979159876603773E-15},{"x":1.499999899417162,"y":2.2615081632102484E-13},{"x":1.5599998980760574,"y":2.0939709637907934E-11},{"x":1.619999896734953,"y":1.3478255479072613E-9},{"x":1.6799998953938484,"y":6.030971087720636E-8},{"x":1.739999894052744,"y":1.875993556111744E-6},{"x":1.7999998927116394,"y":4.056635356393333E-5},{"x":1.859999891370535,"y":6.098052151343168E-4},{"x":1.9199998900294304,"y":0.006372455777420705},{"x":1.9799998886883259,"y":0.04629275844616156},{"x":2.0399998873472214,"y":0.2337813288199048},{"x":2.099999886006117,"y":0.8207239732100083},{"x":2.1599998846650124,"y":2.0029723270505664},{"x":2.219999883323908,"y":3.398156001567204},{"x":2.2799998819828033,"y":4.007764639778572},{"x":2.339999880641699,"y":3.2858795490140857},{"x":2.3999998793005943,"y":1.8728008725028966},{"x":2.45999987795949,"y":0.7420310868049215},{"x":2.5199998766183853,"y":0.20438222867765646},{"x":2.579999875277281,"y":0.03913404089701856},{"x":2.6399998739361763,"y":0.00520902919965667},{"x":2.699999872595072,"y":4.8200264643181317E-4},{"x":2.7599998712539673,"y":3.100506077674955E-5},{"x":2.8199998699128628,"y":1.3864566166371108E-6},{"x":2.8799998685717583,"y":4.3099329696395804E-8},{"x":2.9399998672306538,"y":9.313765097953726E-10},{"x":2.9999998658895493,"y":1.399170301845073E-11}]},{"name":"8f3074a5-9661-4c53-9dfd-d92407ddcfa7","values":[{"x":5.302049790452875,"y":0},{"x":6.302049790452875,"y":1.0},{"x":7.302049790452875,"y":0}]}],"marks":[{"type":"line","from":{"data":"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"8f3074a5-9661-4c53-9dfd-d92407ddcfa7"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec\", :values ({:x -3, :y 0.0} {:x -2.9400000013411045, :y 0.0} {:x -2.880000002682209, :y 0.0} {:x -2.8200000040233135, :y 0.0} {:x -2.760000005364418, :y 0.0} {:x -2.7000000067055225, :y 0.0} {:x -2.640000008046627, :y 0.0} {:x -2.5800000093877316, :y 0.0} {:x -2.520000010728836, :y 0.0} {:x -2.4600000120699406, :y 0.0} {:x -2.400000013411045, :y 0.0} {:x -2.3400000147521496, :y 0.0} {:x -2.280000016093254, :y 0.0} {:x -2.2200000174343586, :y 0.0} {:x -2.160000018775463, :y 0.0} {:x -2.1000000201165676, :y 0.0} {:x -2.040000021457672, :y 0.0} {:x -1.9800000227987766, :y 0.0} {:x -1.9200000241398811, :y 0.0} {:x -1.8600000254809856, :y 0.0} {:x -1.8000000268220901, :y 0.0} {:x -1.7400000281631947, :y 0.0} {:x -1.6800000295042992, :y 0.0} {:x -1.6200000308454037, :y 0.0} {:x -1.5600000321865082, :y 4.4E-323} {:x -1.5000000335276127, :y 4.9113798103E-313} {:x -1.4400000348687172, :y 3.574780202683354E-303} {:x -1.3800000362098217, :y 1.8087798075632448E-293} {:x -1.3200000375509262, :y 6.362277264443301E-284} {:x -1.2600000388920307, :y 1.5557149147154005E-274} {:x -1.2000000402331352, :y 2.644465908450867E-265} {:x -1.1400000415742397, :y 3.1249024413932006E-256} {:x -1.0800000429153442, :y 2.5669977469695233E-247} {:x -1.0200000442564487, :y 1.4659023636055675E-238} {:x -0.9600000455975533, :y 5.819358815166062E-230} {:x -0.9000000469386578, :y 1.6059638332043679E-221} {:x -0.8400000482797623, :y 3.080966091073537E-213} {:x -0.7800000496208668, :y 4.108928743782036E-205} {:x -0.7200000509619713, :y 3.809437342210934E-197} {:x -0.6600000523030758, :y 2.4551814429930886E-189} {:x -0.6000000536441803, :y 1.1000106365270637E-181} {:x -0.5400000549852848, :y 3.426105323550485E-174} {:x -0.4800000563263893, :y 7.418140732437264E-167} {:x -0.4200000576674938, :y 1.1165545874443118E-159} {:x -0.3600000590085983, :y 1.168302714230096E-152} {:x -0.30000006034970284, :y 8.498090358137434E-146} {:x -0.24000006169080734, :y 4.297123512648931E-139} {:x -0.18000006303191185, :y 1.5105143747621218E-132} {:x -0.12000006437301636, :y 3.691156182843066E-126} {:x -0.060000065714120865, :y 6.270331682802175E-120} {:x -6.705522537231445E-8, :y 7.404728517709424E-114} {:x 0.05999993160367012, :y 6.078806230830808E-108} {:x 0.11999993026256561, :y 3.4691093772710382E-102} {:x 0.1799999289214611, :y 1.3762845015356378E-96} {:x 0.2399999275803566, :y 3.795674647579944E-91} {:x 0.2999999262392521, :y 7.277132329850067E-86} {:x 0.3599999248981476, :y 9.698891457036999E-81} {:x 0.4199999235570431, :y 8.986166459405543E-76} {:x 0.47999992221593857, :y 5.7878511394684175E-71} {:x 0.5399999208748341, :y 2.5914974138440473E-66} {:x 0.5999999195337296, :y 8.066306873558855E-62} {:x 0.659999918192625, :y 1.7453769414996687E-57} {:x 0.7199999168515205, :y 2.625392628171194E-53} {:x 0.779999915510416, :y 2.74530007684044E-49} {:x 0.8399999141693115, :y 1.9956111253979068E-45} {:x 0.899999912828207, :y 1.0084457594385378E-41} {:x 0.9599999114871025, :y 3.5425803158997096E-38} {:x 1.019999910145998, :y 8.651220865755213E-35} {:x 1.0799999088048935, :y 1.4686747475789843E-31} {:x 1.139999907463789, :y 1.7332626920942418E-28} {:x 1.1999999061226845, :y 1.4219806410548192E-25} {:x 1.25999990478158, :y 8.109862896734052E-23} {:x 1.3199999034404755, :y 3.215317571586265E-20} {:x 1.379999902099371, :y 8.861857639885287E-18} {:x 1.4399999007582664, :y 1.6979159876603773E-15} {:x 1.499999899417162, :y 2.2615081632102484E-13} {:x 1.5599998980760574, :y 2.0939709637907934E-11} {:x 1.619999896734953, :y 1.3478255479072613E-9} {:x 1.6799998953938484, :y 6.030971087720636E-8} {:x 1.739999894052744, :y 1.875993556111744E-6} {:x 1.7999998927116394, :y 4.056635356393333E-5} {:x 1.859999891370535, :y 6.098052151343168E-4} {:x 1.9199998900294304, :y 0.006372455777420705} {:x 1.9799998886883259, :y 0.04629275844616156} {:x 2.0399998873472214, :y 0.2337813288199048} {:x 2.099999886006117, :y 0.8207239732100083} {:x 2.1599998846650124, :y 2.0029723270505664} {:x 2.219999883323908, :y 3.398156001567204} {:x 2.2799998819828033, :y 4.007764639778572} {:x 2.339999880641699, :y 3.2858795490140857} {:x 2.3999998793005943, :y 1.8728008725028966} {:x 2.45999987795949, :y 0.7420310868049215} {:x 2.5199998766183853, :y 0.20438222867765646} {:x 2.579999875277281, :y 0.03913404089701856} {:x 2.6399998739361763, :y 0.00520902919965667} {:x 2.699999872595072, :y 4.8200264643181317E-4} {:x 2.7599998712539673, :y 3.100506077674955E-5} {:x 2.8199998699128628, :y 1.3864566166371108E-6} {:x 2.8799998685717583, :y 4.3099329696395804E-8} {:x 2.9399998672306538, :y 9.313765097953726E-10} {:x 2.9999998658895493, :y 1.399170301845073E-11})} {:name \"8f3074a5-9661-4c53-9dfd-d92407ddcfa7\", :values ({:x 5.302049790452875, :y 0} {:x 6.302049790452875, :y 1.0} {:x 7.302049790452875, :y 0})}), :marks ({:type \"line\", :from {:data \"db5243db-5dce-4c0c-8e4e-b1fa35ea24ec\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"8f3074a5-9661-4c53-9dfd-d92407ddcfa7\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(def num-particles 100)
(def is-states (take num-particles (infer :importance rejection-gaussian [test-observation])))
(plt/compose
  posterior-plot
  (plt/histogram (repeatedly 1000 #(sample* (categorical (vec (stat/empirical-distribution (stat/collect-results is-states)))))) :normalize :probability-density))
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"317df9a5-a34a-4d7f-a0fa-90317b15db74","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"317df9a5-a34a-4d7f-a0fa-90317b15db74","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"317df9a5-a34a-4d7f-a0fa-90317b15db74","values":[{"x":-3,"y":0.0},{"x":-2.9400000013411045,"y":0.0},{"x":-2.880000002682209,"y":0.0},{"x":-2.8200000040233135,"y":0.0},{"x":-2.760000005364418,"y":0.0},{"x":-2.7000000067055225,"y":0.0},{"x":-2.640000008046627,"y":0.0},{"x":-2.5800000093877316,"y":0.0},{"x":-2.520000010728836,"y":0.0},{"x":-2.4600000120699406,"y":0.0},{"x":-2.400000013411045,"y":0.0},{"x":-2.3400000147521496,"y":0.0},{"x":-2.280000016093254,"y":0.0},{"x":-2.2200000174343586,"y":0.0},{"x":-2.160000018775463,"y":0.0},{"x":-2.1000000201165676,"y":0.0},{"x":-2.040000021457672,"y":0.0},{"x":-1.9800000227987766,"y":0.0},{"x":-1.9200000241398811,"y":0.0},{"x":-1.8600000254809856,"y":0.0},{"x":-1.8000000268220901,"y":0.0},{"x":-1.7400000281631947,"y":0.0},{"x":-1.6800000295042992,"y":0.0},{"x":-1.6200000308454037,"y":0.0},{"x":-1.5600000321865082,"y":4.4E-323},{"x":-1.5000000335276127,"y":4.9113798103E-313},{"x":-1.4400000348687172,"y":3.574780202683354E-303},{"x":-1.3800000362098217,"y":1.8087798075632448E-293},{"x":-1.3200000375509262,"y":6.362277264443301E-284},{"x":-1.2600000388920307,"y":1.5557149147154005E-274},{"x":-1.2000000402331352,"y":2.644465908450867E-265},{"x":-1.1400000415742397,"y":3.1249024413932006E-256},{"x":-1.0800000429153442,"y":2.5669977469695233E-247},{"x":-1.0200000442564487,"y":1.4659023636055675E-238},{"x":-0.9600000455975533,"y":5.819358815166062E-230},{"x":-0.9000000469386578,"y":1.6059638332043679E-221},{"x":-0.8400000482797623,"y":3.080966091073537E-213},{"x":-0.7800000496208668,"y":4.108928743782036E-205},{"x":-0.7200000509619713,"y":3.809437342210934E-197},{"x":-0.6600000523030758,"y":2.4551814429930886E-189},{"x":-0.6000000536441803,"y":1.1000106365270637E-181},{"x":-0.5400000549852848,"y":3.426105323550485E-174},{"x":-0.4800000563263893,"y":7.418140732437264E-167},{"x":-0.4200000576674938,"y":1.1165545874443118E-159},{"x":-0.3600000590085983,"y":1.168302714230096E-152},{"x":-0.30000006034970284,"y":8.498090358137434E-146},{"x":-0.24000006169080734,"y":4.297123512648931E-139},{"x":-0.18000006303191185,"y":1.5105143747621218E-132},{"x":-0.12000006437301636,"y":3.691156182843066E-126},{"x":-0.060000065714120865,"y":6.270331682802175E-120},{"x":-6.705522537231445E-8,"y":7.404728517709424E-114},{"x":0.05999993160367012,"y":6.078806230830808E-108},{"x":0.11999993026256561,"y":3.4691093772710382E-102},{"x":0.1799999289214611,"y":1.3762845015356378E-96},{"x":0.2399999275803566,"y":3.795674647579944E-91},{"x":0.2999999262392521,"y":7.277132329850067E-86},{"x":0.3599999248981476,"y":9.698891457036999E-81},{"x":0.4199999235570431,"y":8.986166459405543E-76},{"x":0.47999992221593857,"y":5.7878511394684175E-71},{"x":0.5399999208748341,"y":2.5914974138440473E-66},{"x":0.5999999195337296,"y":8.066306873558855E-62},{"x":0.659999918192625,"y":1.7453769414996687E-57},{"x":0.7199999168515205,"y":2.625392628171194E-53},{"x":0.779999915510416,"y":2.74530007684044E-49},{"x":0.8399999141693115,"y":1.9956111253979068E-45},{"x":0.899999912828207,"y":1.0084457594385378E-41},{"x":0.9599999114871025,"y":3.5425803158997096E-38},{"x":1.019999910145998,"y":8.651220865755213E-35},{"x":1.0799999088048935,"y":1.4686747475789843E-31},{"x":1.139999907463789,"y":1.7332626920942418E-28},{"x":1.1999999061226845,"y":1.4219806410548192E-25},{"x":1.25999990478158,"y":8.109862896734052E-23},{"x":1.3199999034404755,"y":3.215317571586265E-20},{"x":1.379999902099371,"y":8.861857639885287E-18},{"x":1.4399999007582664,"y":1.6979159876603773E-15},{"x":1.499999899417162,"y":2.2615081632102484E-13},{"x":1.5599998980760574,"y":2.0939709637907934E-11},{"x":1.619999896734953,"y":1.3478255479072613E-9},{"x":1.6799998953938484,"y":6.030971087720636E-8},{"x":1.739999894052744,"y":1.875993556111744E-6},{"x":1.7999998927116394,"y":4.056635356393333E-5},{"x":1.859999891370535,"y":6.098052151343168E-4},{"x":1.9199998900294304,"y":0.006372455777420705},{"x":1.9799998886883259,"y":0.04629275844616156},{"x":2.0399998873472214,"y":0.2337813288199048},{"x":2.099999886006117,"y":0.8207239732100083},{"x":2.1599998846650124,"y":2.0029723270505664},{"x":2.219999883323908,"y":3.398156001567204},{"x":2.2799998819828033,"y":4.007764639778572},{"x":2.339999880641699,"y":3.2858795490140857},{"x":2.3999998793005943,"y":1.8728008725028966},{"x":2.45999987795949,"y":0.7420310868049215},{"x":2.5199998766183853,"y":0.20438222867765646},{"x":2.579999875277281,"y":0.03913404089701856},{"x":2.6399998739361763,"y":0.00520902919965667},{"x":2.699999872595072,"y":4.8200264643181317E-4},{"x":2.7599998712539673,"y":3.100506077674955E-5},{"x":2.8199998699128628,"y":1.3864566166371108E-6},{"x":2.8799998685717583,"y":4.3099329696395804E-8},{"x":2.9399998672306538,"y":9.313765097953726E-10},{"x":2.9999998658895493,"y":1.399170301845073E-11}]},{"name":"14c3c590-c526-4192-9d64-f8f59e01d376","values":[{"x":2.2323856789999263,"y":0},{"x":3.2323856789999263,"y":1.0},{"x":4.232385678999926,"y":0}]}],"marks":[{"type":"line","from":{"data":"317df9a5-a34a-4d7f-a0fa-90317b15db74"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"14c3c590-c526-4192-9d64-f8f59e01d376"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"317df9a5-a34a-4d7f-a0fa-90317b15db74\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"317df9a5-a34a-4d7f-a0fa-90317b15db74\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"317df9a5-a34a-4d7f-a0fa-90317b15db74\", :values ({:x -3, :y 0.0} {:x -2.9400000013411045, :y 0.0} {:x -2.880000002682209, :y 0.0} {:x -2.8200000040233135, :y 0.0} {:x -2.760000005364418, :y 0.0} {:x -2.7000000067055225, :y 0.0} {:x -2.640000008046627, :y 0.0} {:x -2.5800000093877316, :y 0.0} {:x -2.520000010728836, :y 0.0} {:x -2.4600000120699406, :y 0.0} {:x -2.400000013411045, :y 0.0} {:x -2.3400000147521496, :y 0.0} {:x -2.280000016093254, :y 0.0} {:x -2.2200000174343586, :y 0.0} {:x -2.160000018775463, :y 0.0} {:x -2.1000000201165676, :y 0.0} {:x -2.040000021457672, :y 0.0} {:x -1.9800000227987766, :y 0.0} {:x -1.9200000241398811, :y 0.0} {:x -1.8600000254809856, :y 0.0} {:x -1.8000000268220901, :y 0.0} {:x -1.7400000281631947, :y 0.0} {:x -1.6800000295042992, :y 0.0} {:x -1.6200000308454037, :y 0.0} {:x -1.5600000321865082, :y 4.4E-323} {:x -1.5000000335276127, :y 4.9113798103E-313} {:x -1.4400000348687172, :y 3.574780202683354E-303} {:x -1.3800000362098217, :y 1.8087798075632448E-293} {:x -1.3200000375509262, :y 6.362277264443301E-284} {:x -1.2600000388920307, :y 1.5557149147154005E-274} {:x -1.2000000402331352, :y 2.644465908450867E-265} {:x -1.1400000415742397, :y 3.1249024413932006E-256} {:x -1.0800000429153442, :y 2.5669977469695233E-247} {:x -1.0200000442564487, :y 1.4659023636055675E-238} {:x -0.9600000455975533, :y 5.819358815166062E-230} {:x -0.9000000469386578, :y 1.6059638332043679E-221} {:x -0.8400000482797623, :y 3.080966091073537E-213} {:x -0.7800000496208668, :y 4.108928743782036E-205} {:x -0.7200000509619713, :y 3.809437342210934E-197} {:x -0.6600000523030758, :y 2.4551814429930886E-189} {:x -0.6000000536441803, :y 1.1000106365270637E-181} {:x -0.5400000549852848, :y 3.426105323550485E-174} {:x -0.4800000563263893, :y 7.418140732437264E-167} {:x -0.4200000576674938, :y 1.1165545874443118E-159} {:x -0.3600000590085983, :y 1.168302714230096E-152} {:x -0.30000006034970284, :y 8.498090358137434E-146} {:x -0.24000006169080734, :y 4.297123512648931E-139} {:x -0.18000006303191185, :y 1.5105143747621218E-132} {:x -0.12000006437301636, :y 3.691156182843066E-126} {:x -0.060000065714120865, :y 6.270331682802175E-120} {:x -6.705522537231445E-8, :y 7.404728517709424E-114} {:x 0.05999993160367012, :y 6.078806230830808E-108} {:x 0.11999993026256561, :y 3.4691093772710382E-102} {:x 0.1799999289214611, :y 1.3762845015356378E-96} {:x 0.2399999275803566, :y 3.795674647579944E-91} {:x 0.2999999262392521, :y 7.277132329850067E-86} {:x 0.3599999248981476, :y 9.698891457036999E-81} {:x 0.4199999235570431, :y 8.986166459405543E-76} {:x 0.47999992221593857, :y 5.7878511394684175E-71} {:x 0.5399999208748341, :y 2.5914974138440473E-66} {:x 0.5999999195337296, :y 8.066306873558855E-62} {:x 0.659999918192625, :y 1.7453769414996687E-57} {:x 0.7199999168515205, :y 2.625392628171194E-53} {:x 0.779999915510416, :y 2.74530007684044E-49} {:x 0.8399999141693115, :y 1.9956111253979068E-45} {:x 0.899999912828207, :y 1.0084457594385378E-41} {:x 0.9599999114871025, :y 3.5425803158997096E-38} {:x 1.019999910145998, :y 8.651220865755213E-35} {:x 1.0799999088048935, :y 1.4686747475789843E-31} {:x 1.139999907463789, :y 1.7332626920942418E-28} {:x 1.1999999061226845, :y 1.4219806410548192E-25} {:x 1.25999990478158, :y 8.109862896734052E-23} {:x 1.3199999034404755, :y 3.215317571586265E-20} {:x 1.379999902099371, :y 8.861857639885287E-18} {:x 1.4399999007582664, :y 1.6979159876603773E-15} {:x 1.499999899417162, :y 2.2615081632102484E-13} {:x 1.5599998980760574, :y 2.0939709637907934E-11} {:x 1.619999896734953, :y 1.3478255479072613E-9} {:x 1.6799998953938484, :y 6.030971087720636E-8} {:x 1.739999894052744, :y 1.875993556111744E-6} {:x 1.7999998927116394, :y 4.056635356393333E-5} {:x 1.859999891370535, :y 6.098052151343168E-4} {:x 1.9199998900294304, :y 0.006372455777420705} {:x 1.9799998886883259, :y 0.04629275844616156} {:x 2.0399998873472214, :y 0.2337813288199048} {:x 2.099999886006117, :y 0.8207239732100083} {:x 2.1599998846650124, :y 2.0029723270505664} {:x 2.219999883323908, :y 3.398156001567204} {:x 2.2799998819828033, :y 4.007764639778572} {:x 2.339999880641699, :y 3.2858795490140857} {:x 2.3999998793005943, :y 1.8728008725028966} {:x 2.45999987795949, :y 0.7420310868049215} {:x 2.5199998766183853, :y 0.20438222867765646} {:x 2.579999875277281, :y 0.03913404089701856} {:x 2.6399998739361763, :y 0.00520902919965667} {:x 2.699999872595072, :y 4.8200264643181317E-4} {:x 2.7599998712539673, :y 3.100506077674955E-5} {:x 2.8199998699128628, :y 1.3864566166371108E-6} {:x 2.8799998685717583, :y 4.3099329696395804E-8} {:x 2.9399998672306538, :y 9.313765097953726E-10} {:x 2.9999998658895493, :y 1.399170301845073E-11})} {:name \"14c3c590-c526-4192-9d64-f8f59e01d376\", :values ({:x 2.2323856789999263, :y 0} {:x 3.2323856789999263, :y 1.0} {:x 4.232385678999926, :y 0})}), :marks ({:type \"line\", :from {:data \"317df9a5-a34a-4d7f-a0fa-90317b15db74\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"14c3c590-c526-4192-9d64-f8f59e01d376\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=
