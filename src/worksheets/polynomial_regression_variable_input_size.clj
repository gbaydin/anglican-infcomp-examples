;; gorilla-repl.fileformat = 1

;; **
;;; # Polynomial Regression
;; **

;; @@
(ns worksheets.polynomial-regression-variable-number
  (:require [anglican.runtime :refer :all]
            [anglican.emit :refer [defquery with-primitive-procedures]]
            [anglican.stat :refer [empirical-distribution collect-predicts collect-by collect-results]]
            anglican.infcomp.csis
            anglican.importance
            [anglican.infcomp.dists :refer :all]
            [anglican.infcomp.zmq :as zmq]
            [anglican.infcomp.prior :as prior]
            [anglican.inference :refer [infer]]
            [clojure.string :as str]
            anglican.rmh
            anglican.smc
            anglican.infcomp.csis
            anglican.importance
            anglican.infcomp.core)
  (:use [gorilla-plot core]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; ## Model
;; **

;; @@
(defn poly [w x]
  (reduce #(-> %1 (* x) (+ %2)) (reverse w)))

(anglican.infcomp.core/reset-infcomp-addressing-scheme!)
(with-primitive-procedures [poly pow]
  (defquery polynomial-regression [inputs outputs]
    (let [num_inputs (observe (uniform-discrete 5 11) (count inputs))
          inputs (map #(observe (uniform-continuous -1 1) (nth inputs %)) (range num_inputs))
          
          order (sample (discrete [0.25 0.25 0.2 0.15 0.1 0.05]))
          W (repeatedly (inc order) #(sample (laplace 0 1)))]
      (map #(observe (student-t-loc-scale 4 (poly W %1) 0.1) %2) inputs outputs)
      W)))

(with-primitive-procedures [poly pow]
  (defquery polynomial-regression-basic [inputs outputs]
    (let [order (sample (discrete [0.25 0.25 0.2 0.15 0.1 0.05]))
          W (repeatedly (inc order) #(sample (laplace 0 1)))]
      (map #(observe (student-t-loc-scale 4 (poly W %1) 0.1) %2) inputs outputs)
      W)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/polynomial-regression-basic</span>","value":"#'worksheets.polynomial-regression-variable-number/polynomial-regression-basic"}
;; <=

;; **
;;; ## Compiling the model
;; **

;; @@
(defn combine-observes-fn [observes]
  (let [mess (mapv :value observes)
        count_x (first mess)
        X (take count_x (rest mess))
        Y (take count_x (drop count_x (rest mess)))]
    (mapv #(vector %1 %2) X Y)))

(def replier (zmq/start-replier polynomial-regression [(repeat 10 0) (repeat 10 0)] combine-observes-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/replier</span>","value":"#'worksheets.polynomial-regression-variable-number/replier"}
;; <=

;; @@
(zmq/stop-replier replier)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;ZMQ connection terminated.&quot;</span>","value":"\"ZMQ connection terminated.\""}
;; <=

;; **
;;; ## Test the inference
;; **

;; @@
(defn getData [dataset-no]
  (let [file (map #(into [] (map read-string (str/split % #","))) (str/split (slurp (str "plots/polynomial-regression-variable-input-size/data_" dataset-no ".csv")) #"\n"))]
    {:in (nth file 1) :out (nth file 2)}
    ))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/getData</span>","value":"#'worksheets.polynomial-regression-variable-number/getData"}
;; <=

;; @@
(defn print-inference-results [num-particles algorithm-name dataset-no]
  (let [data (getData dataset-no)
        x (:in data)
        y (:out data)
        algorithm (case algorithm-name
                    "is" :importance
                    "smc" :smc
                    "csis" :csis)
        algorithm-options (case algorithm-name
                            "is" []
                            "smc" [:number-of-particles num-particles]
                            "csis" [:observe-embedder-input (mapv #(vector %1 %2) x y)])
        states (take num-particles (apply infer algorithm polynomial-regression [x y] algorithm-options))
        inference-result-string (str/join
                                  "\n"
                                  (map (fn [state] (str/join "," (cons (:log-weight state) (:result state)))) states))]
    (spit (str "plots/polynomial-regression-variable-input-size/" algorithm-name "_" dataset-no "_" num-particles ".csv") inference-result-string)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/print-inference-results</span>","value":"#'worksheets.polynomial-regression-variable-number/print-inference-results"}
;; <=

;; @@
(map #(print-inference-results % "csis" 3) [10 20 40 80 160 320 640 1280 2560])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"(nil nil nil nil nil nil nil nil nil)"}
;; <=

;; @@
(let [inputs (into [] (map #(/ % 10) (range 10)))
      weights [0 0 0 1]
      outputs (map #(poly weights %) inputs)
      other-weights (map :result (take 19 (infer :csis polynomial-regression [inputs outputs] :observe-embedder-input (mapv #(vector %1 %2) inputs outputs))))
      _ (println other-weights)
      prediction-plots (map (fn [W] (list-plot (map (fn [x y] (vector x y)) inputs (map #(poly W %) inputs)) :joined true)) other-weights)]
  (apply compose (cons (list-plot (map #(vector %1 %2) inputs outputs)) prediction-plots))
  )
;; @@
;; ->
;;; ((-0.0848852026936066 -0.24252070614358098 0.8129700468568197 -0.12930469660510385) (-0.1298879945299582 -0.18089707714800807 -0.3169949312390411 -0.27863815122600494 1.0696285366831215 0.37123846743038685) (-0.2758140844657676 -0.364824520086429 2.077800391008891 1.9799527165871644 -2.142220588946691) (0.00755603803646903) (0.09363603064380074 -0.20795839016016035 0.4598328629475127 -0.44192216732115824 -0.41850312749455576) (-0.12841588006211258 -0.020370707483690034 0.6577934929268341 -0.11809408681428539) (-0.056015408515322496 -0.09448287108187148) (-0.045596730452921945) (-0.03481374999956243 -0.01878596214647474) (-0.04936932456767882 -0.12705312341198677) (-0.18722877817069838) (-0.05891099152852244) (-0.04088035964055114) (-0.2629513265138037 -0.2919088452048554 1.0441902134023138 0.9033704891831871) (0.009864313355489818) (-0.034687878447200324 -0.1359432469890209 -0.0060317767633895625) (-0.012174900202428136 -0.2118353947883314) (-0.04886551586020951) (-0.02043035227573869))
;;; 
;; <-
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"609ee380-8e32-4f9b-8009-660c2cddf036","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"609ee380-8e32-4f9b-8009-660c2cddf036","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"609ee380-8e32-4f9b-8009-660c2cddf036","values":[{"x":0,"y":0},{"x":0.1,"y":0.001},{"x":0.2,"y":0.008},{"x":0.3,"y":0.027},{"x":0.4,"y":0.064},{"x":0.5,"y":0.125},{"x":0.6,"y":0.216},{"x":0.7,"y":0.343},{"x":0.8,"y":0.512},{"x":0.9,"y":0.729}]},{"name":"6df3c25d-82cd-4ce9-ac79-31ed433f1c3e","values":[{"x":0,"y":-0.0848852026936066},{"x":0.1,"y":-0.1011368775360016},{"x":0.2,"y":-0.10190497962089083},{"x":0.3,"y":-0.08796533712790491},{"x":0.4,"y":-0.060093778236674486},{"x":0.5,"y":-0.019066131126830144},{"x":0.6,"y":0.03434177602199748},{"x":0.7,"y":0.0993541150301777},{"x":0.8,"y":0.17519505771808008},{"x":0.9,"y":0.2610887759060738}]},{"name":"3f2cdc74-4851-4c53-89f3-607d3004051c","values":[{"x":0,"y":-0.1298879945299582},{"x":0.1,"y":-0.1513156144700328},{"x":0.2,"y":-0.17914611045065879},{"x":0.3,"y":-0.2106437909459873},{"x":0.4,"y":-0.23961488362029723},{"x":0.5,"y":-0.25596204916707843},{"x":0.6,"y":-0.24523889514811548},{"x":0.7,"y":-0.1882044898325711},{"x":0.8,"y":-0.060377876036069755},{"x":0.9,"y":0.16840741504021894}]},{"name":"52312522-288f-48c0-b0ec-7a85e714a868","values":[{"x":0,"y":-0.2758140844657676},{"x":0.1,"y":-0.2897528019066291},{"x":0.2,"y":-0.25325490405231516},{"x":0.3,"y":-0.1621526687235109},{"x":0.4,"y":-0.017419703154373467},{"x":0.5,"y":0.174829056007468},{"x":0.6,"y":0.40333734270091204},{"x":0.7,"y":0.6517075614513853},{"x":0.8,"y":0.8984007873708432},{"x":0.9,"y":1.116736766157767}]},{"name":"7e833313-6e55-4b43-879a-d3ad15872d3b","values":[{"x":0,"y":0.00755603803646903},{"x":0.1,"y":0.00755603803646903},{"x":0.2,"y":0.00755603803646903},{"x":0.3,"y":0.00755603803646903},{"x":0.4,"y":0.00755603803646903},{"x":0.5,"y":0.00755603803646903},{"x":0.6,"y":0.00755603803646903},{"x":0.7,"y":0.00755603803646903},{"x":0.8,"y":0.00755603803646903},{"x":0.9,"y":0.00755603803646903}]},{"name":"6d8021cf-4443-4ed0-a172-d7c7d40a560a","values":[{"x":0,"y":0.09363603064380074},{"x":0.1,"y":0.07695474777718922},{"x":0.2,"y":0.06623268478710863},{"x":0.3,"y":0.057311697410651605},{"x":0.4,"y":0.04502923387892387},{"x":0.5,"y":0.023218334917044225},{"x":0.6,"y":-0.015292366255855477},{"x":0.7,"y":-0.07867864392663038},{"x":0.8,"y":-0.1761206798881225},{"x":0.9,"y":-0.31780306343916076}]},{"name":"c1e1f401-bef8-4908-9a79-8c29fe4d8648","values":[{"x":0,"y":-0.12841588006211258},{"x":0.1,"y":-0.12399310996802752},{"x":0.2,"y":-0.1071230345362915},{"x":0.3,"y":-0.07851421828779023},{"x":0.4,"y":-0.0388752257434094},{"x":0.5,"y":0.011085378575965255},{"x":0.6,"y":0.07065903014944802},{"x":0.7,"y":0.13913716445615326},{"x":0.8,"y":0.21581121697519512},{"x":0.9,"y":0.299972623185688}]},{"name":"36b5c117-2c4f-49de-97b8-f018203a0929","values":[{"x":0,"y":-0.056015408515322496},{"x":0.1,"y":-0.06546369562350965},{"x":0.2,"y":-0.07491198273169679},{"x":0.3,"y":-0.08436026983988394},{"x":0.4,"y":-0.09380855694807108},{"x":0.5,"y":-0.10325684405625823},{"x":0.6,"y":-0.11270513116444539},{"x":0.7,"y":-0.12215341827263253},{"x":0.8,"y":-0.13160170538081967},{"x":0.9,"y":-0.14104999248900685}]},{"name":"00c696ac-2ac6-420d-8688-e422fe886a8c","values":[{"x":0,"y":-0.045596730452921945},{"x":0.1,"y":-0.045596730452921945},{"x":0.2,"y":-0.045596730452921945},{"x":0.3,"y":-0.045596730452921945},{"x":0.4,"y":-0.045596730452921945},{"x":0.5,"y":-0.045596730452921945},{"x":0.6,"y":-0.045596730452921945},{"x":0.7,"y":-0.045596730452921945},{"x":0.8,"y":-0.045596730452921945},{"x":0.9,"y":-0.045596730452921945}]},{"name":"23340e5c-8f99-4319-9e09-8033fe71b9eb","values":[{"x":0,"y":-0.03481374999956243},{"x":0.1,"y":-0.03669234621420991},{"x":0.2,"y":-0.03857094242885738},{"x":0.3,"y":-0.040449538643504854},{"x":0.4,"y":-0.04232813485815233},{"x":0.5,"y":-0.0442067310727998},{"x":0.6,"y":-0.04608532728744727},{"x":0.7,"y":-0.047963923502094746},{"x":0.8,"y":-0.04984251971674222},{"x":0.9,"y":-0.0517211159313897}]},{"name":"dfe29e8b-b245-45b0-b3d8-770bd79c118f","values":[{"x":0,"y":-0.04936932456767882},{"x":0.1,"y":-0.0620746369088775},{"x":0.2,"y":-0.07477994925007617},{"x":0.3,"y":-0.08748526159127484},{"x":0.4,"y":-0.10019057393247352},{"x":0.5,"y":-0.1128958862736722},{"x":0.6,"y":-0.12560119861487087},{"x":0.7,"y":-0.13830651095606955},{"x":0.8,"y":-0.15101182329726823},{"x":0.9,"y":-0.1637171356384669}]},{"name":"0462467e-ddbb-4309-8dc8-d10f87f9d808","values":[{"x":0,"y":-0.18722877817069838},{"x":0.1,"y":-0.18722877817069838},{"x":0.2,"y":-0.18722877817069838},{"x":0.3,"y":-0.18722877817069838},{"x":0.4,"y":-0.18722877817069838},{"x":0.5,"y":-0.18722877817069838},{"x":0.6,"y":-0.18722877817069838},{"x":0.7,"y":-0.18722877817069838},{"x":0.8,"y":-0.18722877817069838},{"x":0.9,"y":-0.18722877817069838}]},{"name":"0131e76d-21d8-4714-ad4f-fc5a405c4870","values":[{"x":0,"y":-0.05891099152852244},{"x":0.1,"y":-0.05891099152852244},{"x":0.2,"y":-0.05891099152852244},{"x":0.3,"y":-0.05891099152852244},{"x":0.4,"y":-0.05891099152852244},{"x":0.5,"y":-0.05891099152852244},{"x":0.6,"y":-0.05891099152852244},{"x":0.7,"y":-0.05891099152852244},{"x":0.8,"y":-0.05891099152852244},{"x":0.9,"y":-0.05891099152852244}]},{"name":"3eacdc7f-c604-449b-ba23-2b5862a0bdbe","values":[{"x":0,"y":-0.04088035964055114},{"x":0.1,"y":-0.04088035964055114},{"x":0.2,"y":-0.04088035964055114},{"x":0.3,"y":-0.04088035964055114},{"x":0.4,"y":-0.04088035964055114},{"x":0.5,"y":-0.04088035964055114},{"x":0.6,"y":-0.04088035964055114},{"x":0.7,"y":-0.04088035964055114},{"x":0.8,"y":-0.04088035964055114},{"x":0.9,"y":-0.04088035964055114}]},{"name":"abc2422c-8527-4939-a95a-b6df9944f4b6","values":[{"x":0,"y":-0.2629513265138037},{"x":0.1,"y":-0.28079693841108294},{"x":0.2,"y":-0.2723385231052167},{"x":0.3,"y":-0.23215585766110602},{"x":0.4,"y":-0.15482871914365165},{"x":0.5,"y":-0.03493688461775457},{"x":0.6,"y":0.13293986885168446},{"x":0.7,"y":0.35422176419976437},{"x":0.8,"y":0.6343290243615848},{"x":0.9,"y":0.9786818722722439}]},{"name":"2d8e3fcc-a45c-495f-957b-6d75a857e459","values":[{"x":0,"y":0.009864313355489818},{"x":0.1,"y":0.009864313355489818},{"x":0.2,"y":0.009864313355489818},{"x":0.3,"y":0.009864313355489818},{"x":0.4,"y":0.009864313355489818},{"x":0.5,"y":0.009864313355489818},{"x":0.6,"y":0.009864313355489818},{"x":0.7,"y":0.009864313355489818},{"x":0.8,"y":0.009864313355489818},{"x":0.9,"y":0.009864313355489818}]},{"name":"2d28b7fd-d6b9-4e18-a627-08098ab8ce37","values":[{"x":0,"y":-0.034687878447200324},{"x":0.1,"y":-0.04834252091373631},{"x":0.2,"y":-0.06211779891554009},{"x":0.3,"y":-0.07601371245261165},{"x":0.4,"y":-0.09003026152495101},{"x":0.5,"y":-0.10416744613255817},{"x":0.6,"y":-0.11842526627543312},{"x":0.7,"y":-0.13280372195357584},{"x":0.8,"y":-0.1473028131669864},{"x":0.9,"y":-0.1619225399156647}]},{"name":"9059fb41-f55b-4cf2-865f-02da3b63a6cb","values":[{"x":0,"y":-0.012174900202428136},{"x":0.1,"y":-0.03335843968126127},{"x":0.2,"y":-0.054541979160094414},{"x":0.3,"y":-0.07572551863892756},{"x":0.4,"y":-0.0969090581177607},{"x":0.5,"y":-0.11809259759659384},{"x":0.6,"y":-0.139276137075427},{"x":0.7,"y":-0.16045967655426013},{"x":0.8,"y":-0.18164321603309327},{"x":0.9,"y":-0.20282675551192642}]},{"name":"1c345b61-c9ef-445f-8cdf-4c475a3277aa","values":[{"x":0,"y":-0.04886551586020951},{"x":0.1,"y":-0.04886551586020951},{"x":0.2,"y":-0.04886551586020951},{"x":0.3,"y":-0.04886551586020951},{"x":0.4,"y":-0.04886551586020951},{"x":0.5,"y":-0.04886551586020951},{"x":0.6,"y":-0.04886551586020951},{"x":0.7,"y":-0.04886551586020951},{"x":0.8,"y":-0.04886551586020951},{"x":0.9,"y":-0.04886551586020951}]},{"name":"2b0f516c-173b-426c-9cc0-2d9c226e10fc","values":[{"x":0,"y":-0.02043035227573869},{"x":0.1,"y":-0.02043035227573869},{"x":0.2,"y":-0.02043035227573869},{"x":0.3,"y":-0.02043035227573869},{"x":0.4,"y":-0.02043035227573869},{"x":0.5,"y":-0.02043035227573869},{"x":0.6,"y":-0.02043035227573869},{"x":0.7,"y":-0.02043035227573869},{"x":0.8,"y":-0.02043035227573869},{"x":0.9,"y":-0.02043035227573869}]}],"marks":[{"type":"symbol","from":{"data":"609ee380-8e32-4f9b-8009-660c2cddf036"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"6df3c25d-82cd-4ce9-ac79-31ed433f1c3e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"3f2cdc74-4851-4c53-89f3-607d3004051c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"52312522-288f-48c0-b0ec-7a85e714a868"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"7e833313-6e55-4b43-879a-d3ad15872d3b"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"6d8021cf-4443-4ed0-a172-d7c7d40a560a"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"c1e1f401-bef8-4908-9a79-8c29fe4d8648"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"36b5c117-2c4f-49de-97b8-f018203a0929"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"00c696ac-2ac6-420d-8688-e422fe886a8c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"23340e5c-8f99-4319-9e09-8033fe71b9eb"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"dfe29e8b-b245-45b0-b3d8-770bd79c118f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"0462467e-ddbb-4309-8dc8-d10f87f9d808"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"0131e76d-21d8-4714-ad4f-fc5a405c4870"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"3eacdc7f-c604-449b-ba23-2b5862a0bdbe"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"abc2422c-8527-4939-a95a-b6df9944f4b6"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"2d8e3fcc-a45c-495f-957b-6d75a857e459"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"2d28b7fd-d6b9-4e18-a627-08098ab8ce37"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"9059fb41-f55b-4cf2-865f-02da3b63a6cb"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"1c345b61-c9ef-445f-8cdf-4c475a3277aa"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"2b0f516c-173b-426c-9cc0-2d9c226e10fc"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"609ee380-8e32-4f9b-8009-660c2cddf036\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"609ee380-8e32-4f9b-8009-660c2cddf036\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"609ee380-8e32-4f9b-8009-660c2cddf036\", :values ({:x 0, :y 0} {:x 1/10, :y 1/1000} {:x 1/5, :y 1/125} {:x 3/10, :y 27/1000} {:x 2/5, :y 8/125} {:x 1/2, :y 1/8} {:x 3/5, :y 27/125} {:x 7/10, :y 343/1000} {:x 4/5, :y 64/125} {:x 9/10, :y 729/1000})} {:name \"6df3c25d-82cd-4ce9-ac79-31ed433f1c3e\", :values ({:x 0, :y -0.0848852026936066} {:x 1/10, :y -0.1011368775360016} {:x 1/5, :y -0.10190497962089083} {:x 3/10, :y -0.08796533712790491} {:x 2/5, :y -0.060093778236674486} {:x 1/2, :y -0.019066131126830144} {:x 3/5, :y 0.03434177602199748} {:x 7/10, :y 0.0993541150301777} {:x 4/5, :y 0.17519505771808008} {:x 9/10, :y 0.2610887759060738})} {:name \"3f2cdc74-4851-4c53-89f3-607d3004051c\", :values ({:x 0, :y -0.1298879945299582} {:x 1/10, :y -0.1513156144700328} {:x 1/5, :y -0.17914611045065879} {:x 3/10, :y -0.2106437909459873} {:x 2/5, :y -0.23961488362029723} {:x 1/2, :y -0.25596204916707843} {:x 3/5, :y -0.24523889514811548} {:x 7/10, :y -0.1882044898325711} {:x 4/5, :y -0.060377876036069755} {:x 9/10, :y 0.16840741504021894})} {:name \"52312522-288f-48c0-b0ec-7a85e714a868\", :values ({:x 0, :y -0.2758140844657676} {:x 1/10, :y -0.2897528019066291} {:x 1/5, :y -0.25325490405231516} {:x 3/10, :y -0.1621526687235109} {:x 2/5, :y -0.017419703154373467} {:x 1/2, :y 0.174829056007468} {:x 3/5, :y 0.40333734270091204} {:x 7/10, :y 0.6517075614513853} {:x 4/5, :y 0.8984007873708432} {:x 9/10, :y 1.116736766157767})} {:name \"7e833313-6e55-4b43-879a-d3ad15872d3b\", :values ({:x 0, :y 0.00755603803646903} {:x 1/10, :y 0.00755603803646903} {:x 1/5, :y 0.00755603803646903} {:x 3/10, :y 0.00755603803646903} {:x 2/5, :y 0.00755603803646903} {:x 1/2, :y 0.00755603803646903} {:x 3/5, :y 0.00755603803646903} {:x 7/10, :y 0.00755603803646903} {:x 4/5, :y 0.00755603803646903} {:x 9/10, :y 0.00755603803646903})} {:name \"6d8021cf-4443-4ed0-a172-d7c7d40a560a\", :values ({:x 0, :y 0.09363603064380074} {:x 1/10, :y 0.07695474777718922} {:x 1/5, :y 0.06623268478710863} {:x 3/10, :y 0.057311697410651605} {:x 2/5, :y 0.04502923387892387} {:x 1/2, :y 0.023218334917044225} {:x 3/5, :y -0.015292366255855477} {:x 7/10, :y -0.07867864392663038} {:x 4/5, :y -0.1761206798881225} {:x 9/10, :y -0.31780306343916076})} {:name \"c1e1f401-bef8-4908-9a79-8c29fe4d8648\", :values ({:x 0, :y -0.12841588006211258} {:x 1/10, :y -0.12399310996802752} {:x 1/5, :y -0.1071230345362915} {:x 3/10, :y -0.07851421828779023} {:x 2/5, :y -0.0388752257434094} {:x 1/2, :y 0.011085378575965255} {:x 3/5, :y 0.07065903014944802} {:x 7/10, :y 0.13913716445615326} {:x 4/5, :y 0.21581121697519512} {:x 9/10, :y 0.299972623185688})} {:name \"36b5c117-2c4f-49de-97b8-f018203a0929\", :values ({:x 0, :y -0.056015408515322496} {:x 1/10, :y -0.06546369562350965} {:x 1/5, :y -0.07491198273169679} {:x 3/10, :y -0.08436026983988394} {:x 2/5, :y -0.09380855694807108} {:x 1/2, :y -0.10325684405625823} {:x 3/5, :y -0.11270513116444539} {:x 7/10, :y -0.12215341827263253} {:x 4/5, :y -0.13160170538081967} {:x 9/10, :y -0.14104999248900685})} {:name \"00c696ac-2ac6-420d-8688-e422fe886a8c\", :values ({:x 0, :y -0.045596730452921945} {:x 1/10, :y -0.045596730452921945} {:x 1/5, :y -0.045596730452921945} {:x 3/10, :y -0.045596730452921945} {:x 2/5, :y -0.045596730452921945} {:x 1/2, :y -0.045596730452921945} {:x 3/5, :y -0.045596730452921945} {:x 7/10, :y -0.045596730452921945} {:x 4/5, :y -0.045596730452921945} {:x 9/10, :y -0.045596730452921945})} {:name \"23340e5c-8f99-4319-9e09-8033fe71b9eb\", :values ({:x 0, :y -0.03481374999956243} {:x 1/10, :y -0.03669234621420991} {:x 1/5, :y -0.03857094242885738} {:x 3/10, :y -0.040449538643504854} {:x 2/5, :y -0.04232813485815233} {:x 1/2, :y -0.0442067310727998} {:x 3/5, :y -0.04608532728744727} {:x 7/10, :y -0.047963923502094746} {:x 4/5, :y -0.04984251971674222} {:x 9/10, :y -0.0517211159313897})} {:name \"dfe29e8b-b245-45b0-b3d8-770bd79c118f\", :values ({:x 0, :y -0.04936932456767882} {:x 1/10, :y -0.0620746369088775} {:x 1/5, :y -0.07477994925007617} {:x 3/10, :y -0.08748526159127484} {:x 2/5, :y -0.10019057393247352} {:x 1/2, :y -0.1128958862736722} {:x 3/5, :y -0.12560119861487087} {:x 7/10, :y -0.13830651095606955} {:x 4/5, :y -0.15101182329726823} {:x 9/10, :y -0.1637171356384669})} {:name \"0462467e-ddbb-4309-8dc8-d10f87f9d808\", :values ({:x 0, :y -0.18722877817069838} {:x 1/10, :y -0.18722877817069838} {:x 1/5, :y -0.18722877817069838} {:x 3/10, :y -0.18722877817069838} {:x 2/5, :y -0.18722877817069838} {:x 1/2, :y -0.18722877817069838} {:x 3/5, :y -0.18722877817069838} {:x 7/10, :y -0.18722877817069838} {:x 4/5, :y -0.18722877817069838} {:x 9/10, :y -0.18722877817069838})} {:name \"0131e76d-21d8-4714-ad4f-fc5a405c4870\", :values ({:x 0, :y -0.05891099152852244} {:x 1/10, :y -0.05891099152852244} {:x 1/5, :y -0.05891099152852244} {:x 3/10, :y -0.05891099152852244} {:x 2/5, :y -0.05891099152852244} {:x 1/2, :y -0.05891099152852244} {:x 3/5, :y -0.05891099152852244} {:x 7/10, :y -0.05891099152852244} {:x 4/5, :y -0.05891099152852244} {:x 9/10, :y -0.05891099152852244})} {:name \"3eacdc7f-c604-449b-ba23-2b5862a0bdbe\", :values ({:x 0, :y -0.04088035964055114} {:x 1/10, :y -0.04088035964055114} {:x 1/5, :y -0.04088035964055114} {:x 3/10, :y -0.04088035964055114} {:x 2/5, :y -0.04088035964055114} {:x 1/2, :y -0.04088035964055114} {:x 3/5, :y -0.04088035964055114} {:x 7/10, :y -0.04088035964055114} {:x 4/5, :y -0.04088035964055114} {:x 9/10, :y -0.04088035964055114})} {:name \"abc2422c-8527-4939-a95a-b6df9944f4b6\", :values ({:x 0, :y -0.2629513265138037} {:x 1/10, :y -0.28079693841108294} {:x 1/5, :y -0.2723385231052167} {:x 3/10, :y -0.23215585766110602} {:x 2/5, :y -0.15482871914365165} {:x 1/2, :y -0.03493688461775457} {:x 3/5, :y 0.13293986885168446} {:x 7/10, :y 0.35422176419976437} {:x 4/5, :y 0.6343290243615848} {:x 9/10, :y 0.9786818722722439})} {:name \"2d8e3fcc-a45c-495f-957b-6d75a857e459\", :values ({:x 0, :y 0.009864313355489818} {:x 1/10, :y 0.009864313355489818} {:x 1/5, :y 0.009864313355489818} {:x 3/10, :y 0.009864313355489818} {:x 2/5, :y 0.009864313355489818} {:x 1/2, :y 0.009864313355489818} {:x 3/5, :y 0.009864313355489818} {:x 7/10, :y 0.009864313355489818} {:x 4/5, :y 0.009864313355489818} {:x 9/10, :y 0.009864313355489818})} {:name \"2d28b7fd-d6b9-4e18-a627-08098ab8ce37\", :values ({:x 0, :y -0.034687878447200324} {:x 1/10, :y -0.04834252091373631} {:x 1/5, :y -0.06211779891554009} {:x 3/10, :y -0.07601371245261165} {:x 2/5, :y -0.09003026152495101} {:x 1/2, :y -0.10416744613255817} {:x 3/5, :y -0.11842526627543312} {:x 7/10, :y -0.13280372195357584} {:x 4/5, :y -0.1473028131669864} {:x 9/10, :y -0.1619225399156647})} {:name \"9059fb41-f55b-4cf2-865f-02da3b63a6cb\", :values ({:x 0, :y -0.012174900202428136} {:x 1/10, :y -0.03335843968126127} {:x 1/5, :y -0.054541979160094414} {:x 3/10, :y -0.07572551863892756} {:x 2/5, :y -0.0969090581177607} {:x 1/2, :y -0.11809259759659384} {:x 3/5, :y -0.139276137075427} {:x 7/10, :y -0.16045967655426013} {:x 4/5, :y -0.18164321603309327} {:x 9/10, :y -0.20282675551192642})} {:name \"1c345b61-c9ef-445f-8cdf-4c475a3277aa\", :values ({:x 0, :y -0.04886551586020951} {:x 1/10, :y -0.04886551586020951} {:x 1/5, :y -0.04886551586020951} {:x 3/10, :y -0.04886551586020951} {:x 2/5, :y -0.04886551586020951} {:x 1/2, :y -0.04886551586020951} {:x 3/5, :y -0.04886551586020951} {:x 7/10, :y -0.04886551586020951} {:x 4/5, :y -0.04886551586020951} {:x 9/10, :y -0.04886551586020951})} {:name \"2b0f516c-173b-426c-9cc0-2d9c226e10fc\", :values ({:x 0, :y -0.02043035227573869} {:x 1/10, :y -0.02043035227573869} {:x 1/5, :y -0.02043035227573869} {:x 3/10, :y -0.02043035227573869} {:x 2/5, :y -0.02043035227573869} {:x 1/2, :y -0.02043035227573869} {:x 3/5, :y -0.02043035227573869} {:x 7/10, :y -0.02043035227573869} {:x 4/5, :y -0.02043035227573869} {:x 9/10, :y -0.02043035227573869})}), :marks ({:type \"symbol\", :from {:data \"609ee380-8e32-4f9b-8009-660c2cddf036\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"6df3c25d-82cd-4ce9-ac79-31ed433f1c3e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"3f2cdc74-4851-4c53-89f3-607d3004051c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"52312522-288f-48c0-b0ec-7a85e714a868\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"7e833313-6e55-4b43-879a-d3ad15872d3b\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"6d8021cf-4443-4ed0-a172-d7c7d40a560a\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"c1e1f401-bef8-4908-9a79-8c29fe4d8648\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"36b5c117-2c4f-49de-97b8-f018203a0929\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"00c696ac-2ac6-420d-8688-e422fe886a8c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"23340e5c-8f99-4319-9e09-8033fe71b9eb\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"dfe29e8b-b245-45b0-b3d8-770bd79c118f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"0462467e-ddbb-4309-8dc8-d10f87f9d808\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"0131e76d-21d8-4714-ad4f-fc5a405c4870\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"3eacdc7f-c604-449b-ba23-2b5862a0bdbe\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"abc2422c-8527-4939-a95a-b6df9944f4b6\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"2d8e3fcc-a45c-495f-957b-6d75a857e459\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"2d28b7fd-d6b9-4e18-a627-08098ab8ce37\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"9059fb41-f55b-4cf2-865f-02da3b63a6cb\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"1c345b61-c9ef-445f-8cdf-4c475a3277aa\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"2b0f516c-173b-426c-9cc0-2d9c226e10fc\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(let [inputs (into [] (map #(/ % 10) (range 10)))
      weights [0 0 0 1]
      outputs (map #(poly weights %) inputs)
      other-weights (map :result (take 10 (drop 1000 (infer :rmh polynomial-regression-basic [inputs outputs]))))
      prediction-plots (map (fn [W] (list-plot (map #(poly W %) inputs) :joined true)) other-weights)]
  (apply compose (cons (list-plot outputs) prediction-plots))
  )
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2","values":[{"x":0,"y":0},{"x":1,"y":0.001},{"x":2,"y":0.008},{"x":3,"y":0.027},{"x":4,"y":0.064},{"x":5,"y":0.125},{"x":6,"y":0.216},{"x":7,"y":0.343},{"x":8,"y":0.512},{"x":9,"y":0.729}]},{"name":"48622592-e943-4279-b2d8-59bc43be174d","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"688a7d05-78a8-4e8f-ba78-3bc5c9086d05","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"1c514371-6f86-436b-b59b-01e0cc25a995","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"1aac2669-e925-438c-80a9-bce297b49ea0","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"e6a80764-5c80-4e22-af20-fa7faf561a5e","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"313c3e31-6519-427e-84bb-16c73b58beac","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"0084669c-e035-4ec9-97c4-00b2c5bf1104","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"16d1c137-9917-4ff7-a6c3-471bf252c70d","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"856862bb-e925-40d3-9353-9c2e8de570c9","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]},{"name":"9f57e063-b8ef-4be8-87cd-3adaaa5fb966","values":[{"x":0,"y":-0.10667047891010052},{"x":1,"y":-0.09331133403274804},{"x":2,"y":-0.07128607727085386},{"x":3,"y":-0.0352100924519506},{"x":4,"y":0.020301236596429198},{"x":5,"y":0.10063252604675287},{"x":6,"y":0.2111683920714878},{"x":7,"y":0.35729345084310155},{"x":8,"y":0.5443923185340617},{"x":9,"y":0.7778496113168349}]}],"marks":[{"type":"symbol","from":{"data":"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"48622592-e943-4279-b2d8-59bc43be174d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"688a7d05-78a8-4e8f-ba78-3bc5c9086d05"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"1c514371-6f86-436b-b59b-01e0cc25a995"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"1aac2669-e925-438c-80a9-bce297b49ea0"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"e6a80764-5c80-4e22-af20-fa7faf561a5e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"313c3e31-6519-427e-84bb-16c73b58beac"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"0084669c-e035-4ec9-97c4-00b2c5bf1104"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"16d1c137-9917-4ff7-a6c3-471bf252c70d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"856862bb-e925-40d3-9353-9c2e8de570c9"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"9f57e063-b8ef-4be8-87cd-3adaaa5fb966"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2\", :values ({:x 0, :y 0} {:x 1, :y 1/1000} {:x 2, :y 1/125} {:x 3, :y 27/1000} {:x 4, :y 8/125} {:x 5, :y 1/8} {:x 6, :y 27/125} {:x 7, :y 343/1000} {:x 8, :y 64/125} {:x 9, :y 729/1000})} {:name \"48622592-e943-4279-b2d8-59bc43be174d\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"688a7d05-78a8-4e8f-ba78-3bc5c9086d05\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"1c514371-6f86-436b-b59b-01e0cc25a995\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"1aac2669-e925-438c-80a9-bce297b49ea0\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"e6a80764-5c80-4e22-af20-fa7faf561a5e\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"313c3e31-6519-427e-84bb-16c73b58beac\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"0084669c-e035-4ec9-97c4-00b2c5bf1104\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"16d1c137-9917-4ff7-a6c3-471bf252c70d\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"856862bb-e925-40d3-9353-9c2e8de570c9\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})} {:name \"9f57e063-b8ef-4be8-87cd-3adaaa5fb966\", :values ({:x 0, :y -0.10667047891010052} {:x 1, :y -0.09331133403274804} {:x 2, :y -0.07128607727085386} {:x 3, :y -0.0352100924519506} {:x 4, :y 0.020301236596429198} {:x 5, :y 0.10063252604675287} {:x 6, :y 0.2111683920714878} {:x 7, :y 0.35729345084310155} {:x 8, :y 0.5443923185340617} {:x 9, :y 0.7778496113168349})}), :marks ({:type \"symbol\", :from {:data \"c44a2f52-e6c2-4fc0-9a65-aecd253f95b2\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"48622592-e943-4279-b2d8-59bc43be174d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"688a7d05-78a8-4e8f-ba78-3bc5c9086d05\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"1c514371-6f86-436b-b59b-01e0cc25a995\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"1aac2669-e925-438c-80a9-bce297b49ea0\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"e6a80764-5c80-4e22-af20-fa7faf561a5e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"313c3e31-6519-427e-84bb-16c73b58beac\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"0084669c-e035-4ec9-97c4-00b2c5bf1104\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"16d1c137-9917-4ff7-a6c3-471bf252c70d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"856862bb-e925-40d3-9353-9c2e8de570c9\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"9f57e063-b8ef-4be8-87cd-3adaaa5fb966\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(let [dataset-no 3
      particle-range [10 20 40 80 160 320 640 1280 2560]]
  (map #(print-inference-results % "csis" dataset-no) particle-range))
;; @@

;; **
;;; Plot the results:
;; **

;; @@
;(let [ dataset 1
;       weights [1 -1]
;       inputs (map #(float (/ % 10)) (range -9 10 3))
;       observation-string (str/join "," (map #(sample* (student-t-loc-scale 4 (poly weights %) 0.1)) inputs))
;       input-string (str/join "," inputs)
;       weight-string (str/join "," weights)
;       file-contents (str/join "\n" [weight-string input-string observation-string])]
;  (spit (str "plots/polynomial-regression-variable-input-size/data_" dataset "_test.csv") file-contents))

;; @@

;; @@

;; @@

;; @@
(let [])
;; @@
