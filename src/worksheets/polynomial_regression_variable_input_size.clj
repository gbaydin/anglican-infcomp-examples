;; gorilla-repl.fileformat = 1

;; **
;;; # Polynomial Regression
;; **

;; @@
(ns worksheets.polynomial-regression-variable-number
  (:require [anglican.runtime :refer :all]
            [anglican.emit :refer [defquery with-primitive-procedures]]
            [anglican.stat :refer [empirical-distribution collect-predicts collect-by collect-results]]
            anglican.infcomp.csis
            anglican.importance
            [anglican.infcomp.dists :refer :all]
            [anglican.infcomp.zmq :as zmq]
            [anglican.infcomp.prior :as prior]
            [anglican.inference :refer [infer]]
            [clojure.string :as str]
            anglican.rmh
            anglican.smc
            anglican.infcomp.csis
            anglican.importance
            anglican.infcomp.core)
  (:use [gorilla-plot core]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; ## Model
;; **

;; @@
(defn poly [w x]
  (reduce #(-> %1 (* x) (+ %2)) (reverse w)))

(anglican.infcomp.core/reset-infcomp-addressing-scheme!)
(with-primitive-procedures [poly pow]
  (defquery polynomial-regression [inputs outputs]
    (let [num_inputs (observe (uniform-discrete 5 11) (count inputs))
          inputs (map #(observe (uniform-continuous -1 1) (nth inputs %)) (range num_inputs))
          
          order (sample (discrete [0.25 0.25 0.2 0.15 0.1 0.05]))
          W (repeatedly (inc order) #(sample (laplace 0 1)))]
      (map #(observe (student-t-loc-scale 4 (poly W %1) 0.1) %2) inputs outputs)
      W)))

(with-primitive-procedures [poly pow]
  (defquery polynomial-regression-basic [inputs outputs]
    (let [order (sample (discrete [0.25 0.25 0.2 0.15 0.1 0.05]))
          W (repeatedly (inc order) #(sample (laplace 0 1)))]
      (map #(observe (student-t-loc-scale 4 (poly W %1) 0.1) %2) inputs outputs)
      W)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/polynomial-regression-basic</span>","value":"#'worksheets.polynomial-regression-variable-number/polynomial-regression-basic"}
;; <=

;; **
;;; ## Compiling the model
;; **

;; @@
(defn combine-observes-fn [observes]
  (let [mess (mapv :value observes)
        count_x (first mess)
        X (take count_x (rest mess))
        Y (take count_x (drop count_x (rest mess)))]
    (mapv #(vector %1 %2) X Y)))

(def replier (zmq/start-replier polynomial-regression [(repeat 10 0) (repeat 10 0)] combine-observes-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/replier</span>","value":"#'worksheets.polynomial-regression-variable-number/replier"}
;; <=

;; @@
(zmq/stop-replier replier)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;ZMQ connection terminated.&quot;</span>","value":"\"ZMQ connection terminated.\""}
;; <=

;; **
;;; ## Test the inference
;; **

;; @@
(defn getData [dataset-no]
  (let [file (map #(into [] (map read-string (str/split % #","))) (str/split (slurp (str "plots/polynomial-regression-variable-x/data_" dataset-no ".csv")) #"\n"))]
    {:in (nth file 1) :out (nth file 2)}
    ))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/getData</span>","value":"#'worksheets.polynomial-regression-variable-number/getData"}
;; <=

;; @@
(defn print-inference-results [num-particles algorithm-name dataset-no]
  (let [data (getData dataset-no)
        x (:in data)
        y (:out data)
        algorithm (case algorithm-name
                    "is" :importance
                    "smc" :smc
                    "csis" :csis)
        algorithm-options (case algorithm-name
                            "is" []
                            "smc" [:number-of-particles num-particles]
                            "csis" [:observe-embedder-input (mapv #(vector %1 %2) x y)])
        states (take num-particles (apply infer algorithm polynomial-regression [x y] algorithm-options))
        inference-result-string (str/join
                                  "\n"
                                  (map (fn [state] (str/join "," (cons (:log-weight state) (:result state)))) states))]
    (spit (str "plots/polynomial-regression-variable-input-size/" algorithm-name "_" dataset-no "_" num-particles ".csv") inference-result-string)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.polynomial-regression-variable-number/print-inference-results</span>","value":"#'worksheets.polynomial-regression-variable-number/print-inference-results"}
;; <=

;; @@
(let [inputs (into [] (map #(/ % 10) (range 10)))
      weights [0 0 0 1]
      outputs (map #(poly weights %) inputs)
      other-weights (map :result (take 19 (infer :csis polynomial-regression [inputs outputs] :observe-embedder-input (mapv #(vector %1 %2) inputs outputs))))
      _ (println other-weights)
      prediction-plots (map (fn [W] (list-plot (map (fn [x y] (vector x y)) inputs (map #(poly W %) inputs)) :joined true)) other-weights)]
  (apply compose (cons (list-plot (map #(vector %1 %2) inputs outputs)) prediction-plots))
  )
;; @@
;; ->
;;; ((-0.09094520866899627) (-0.07309727226111208) (-0.14335821644436444 -0.7684984643207954 1.2848391835237685 -1.5927681808603424) (-0.5216455172522331 0.20584290504905292 1.471128049292677) (-0.013909740251715867) (0.07279110369164145 0.013168642052102077 -0.022460931100023562) (0.23917938394091387) (-0.0493522298231436) (-0.03548236041325674 0.1313845699121982 -0.10421678768567151 0.5186092143137182 0.8353389447881182) (0.011786763575410572 0.5754519384934226) (-0.1402009616013139) (-0.0864253752685594 0.10417452276864933) (0.32202772106348676 0.03192189151342098 -2.1382298805386024 0.2417238381950094) (-0.0644938653578349 0.179121274672444) (0.0646824293793023) (-0.052032950076682974) (-0.023827159498599603 0.025610841559406627 0.14126854498683078) (-0.18729420842076905 -0.3344801047533952 -0.1515006663267131 0.884310192992143) (-0.14586422659157094 0.20620271781273117))
;;; 
;; <-
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"df903a6c-fe04-4e48-820d-b09f2c35bb5c","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"df903a6c-fe04-4e48-820d-b09f2c35bb5c","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"df903a6c-fe04-4e48-820d-b09f2c35bb5c","values":[{"x":0,"y":0},{"x":0.1,"y":0.001},{"x":0.2,"y":0.008},{"x":0.3,"y":0.027},{"x":0.4,"y":0.064},{"x":0.5,"y":0.125},{"x":0.6,"y":0.216},{"x":0.7,"y":0.343},{"x":0.8,"y":0.512},{"x":0.9,"y":0.729}]},{"name":"2db2e063-7f5d-4bff-9c6b-80a2b1e06b21","values":[{"x":0,"y":-0.09094520866899627},{"x":0.1,"y":-0.09094520866899627},{"x":0.2,"y":-0.09094520866899627},{"x":0.3,"y":-0.09094520866899627},{"x":0.4,"y":-0.09094520866899627},{"x":0.5,"y":-0.09094520866899627},{"x":0.6,"y":-0.09094520866899627},{"x":0.7,"y":-0.09094520866899627},{"x":0.8,"y":-0.09094520866899627},{"x":0.9,"y":-0.09094520866899627}]},{"name":"f8692132-7c03-4338-915d-d2653187adbe","values":[{"x":0,"y":-0.07309727226111208},{"x":0.1,"y":-0.07309727226111208},{"x":0.2,"y":-0.07309727226111208},{"x":0.3,"y":-0.07309727226111208},{"x":0.4,"y":-0.07309727226111208},{"x":0.5,"y":-0.07309727226111208},{"x":0.6,"y":-0.07309727226111208},{"x":0.7,"y":-0.07309727226111208},{"x":0.8,"y":-0.07309727226111208},{"x":0.9,"y":-0.07309727226111208}]},{"name":"01bcadca-8a26-42e9-8311-cf10eaecfef1","values":[{"x":0,"y":-0.14335821644436444},{"x":0.1,"y":-0.20895243922206663},{"x":0.2,"y":-0.2584064874144555},{"x":0.3,"y":-0.30127697010669313},{"x":0.4,"y":-0.3471204963839416},{"x":0.5,"y":-0.4054936753313628},{"x":0.6,"y":-0.48595311603411895},{"x":0.7,"y":-0.598055427577372},{"x":0.8,"y":-0.7513572190462844},{"x":0.9,"y":-0.9554150995260174}]},{"name":"74b724bd-2aba-4b94-a82b-673bd81b686f","values":[{"x":0,"y":-0.5216455172522331},{"x":0.1,"y":-0.48634994625440103},{"x":0.2,"y":-0.4216318142707154},{"x":0.3,"y":-0.3274911213011763},{"x":0.4,"y":-0.20392786734578355},{"x":0.5,"y":-0.050942052404537363},{"x":0.6,"y":0.13146632352256238},{"x":0.7,"y":0.34329726043551556},{"x":0.8,"y":0.5845507583343227},{"x":0.9,"y":0.8552268172189831}]},{"name":"8dca3714-e541-401d-9961-e98f9e29c14f","values":[{"x":0,"y":-0.013909740251715867},{"x":0.1,"y":-0.013909740251715867},{"x":0.2,"y":-0.013909740251715867},{"x":0.3,"y":-0.013909740251715867},{"x":0.4,"y":-0.013909740251715867},{"x":0.5,"y":-0.013909740251715867},{"x":0.6,"y":-0.013909740251715867},{"x":0.7,"y":-0.013909740251715867},{"x":0.8,"y":-0.013909740251715867},{"x":0.9,"y":-0.013909740251715867}]},{"name":"e0326b05-1d96-49a7-8496-74e640afda47","values":[{"x":0,"y":0.07279110369164145},{"x":0.1,"y":0.07388335858585142},{"x":0.2,"y":0.07452639485806092},{"x":0.3,"y":0.07472021250826995},{"x":0.4,"y":0.0744648115364785},{"x":0.5,"y":0.0737601919426866},{"x":0.6,"y":0.07260635372689421},{"x":0.7,"y":0.07100329688910136},{"x":0.8,"y":0.06895102142930803},{"x":0.9,"y":0.06644952734751423}]},{"name":"b89e400f-8e0f-44e4-8b35-b69d810e069c","values":[{"x":0,"y":0.23917938394091387},{"x":0.1,"y":0.23917938394091387},{"x":0.2,"y":0.23917938394091387},{"x":0.3,"y":0.23917938394091387},{"x":0.4,"y":0.23917938394091387},{"x":0.5,"y":0.23917938394091387},{"x":0.6,"y":0.23917938394091387},{"x":0.7,"y":0.23917938394091387},{"x":0.8,"y":0.23917938394091387},{"x":0.9,"y":0.23917938394091387}]},{"name":"f0c2cf61-d91d-4c02-ac5b-3a2fe7f06ad2","values":[{"x":0,"y":-0.0493522298231436},{"x":0.1,"y":-0.0493522298231436},{"x":0.2,"y":-0.0493522298231436},{"x":0.3,"y":-0.0493522298231436},{"x":0.4,"y":-0.0493522298231436},{"x":0.5,"y":-0.0493522298231436},{"x":0.6,"y":-0.0493522298231436},{"x":0.7,"y":-0.0493522298231436},{"x":0.8,"y":-0.0493522298231436},{"x":0.9,"y":-0.0493522298231436}]},{"name":"d0908fc4-af1d-44d4-9e21-16f02014b841","values":[{"x":0,"y":-0.03548236041325674},{"x":0.1,"y":-0.022783928190101103},{"x":0.2,"y":-0.00788870191207322},{"x":0.3,"y":0.015322193907946431},{"x":0.4,"y":0.05497244822456891},{"x":0.5,"y":0.12119056345989666},{"x":0.6,"y":0.22610985550352358},{"x":0.7,"y":0.3838684537125355},{"x":0.8,"y":0.6106093009115091},{"x":0.9,"y":0.9244801533925128}]},{"name":"48068814-0c1a-45ba-b055-650100a4dfaa","values":[{"x":0,"y":0.011786763575410572},{"x":0.1,"y":0.06933195742475283},{"x":0.2,"y":0.1268771512740951},{"x":0.3,"y":0.18442234512343736},{"x":0.4,"y":0.24196753897277962},{"x":0.5,"y":0.2995127328221219},{"x":0.6,"y":0.35705792667146413},{"x":0.7,"y":0.4146031205208064},{"x":0.8,"y":0.47214831437014865},{"x":0.9,"y":0.5296935082194909}]},{"name":"fe5e3145-3568-43f2-ac1a-60ca03c83a79","values":[{"x":0,"y":-0.1402009616013139},{"x":0.1,"y":-0.1402009616013139},{"x":0.2,"y":-0.1402009616013139},{"x":0.3,"y":-0.1402009616013139},{"x":0.4,"y":-0.1402009616013139},{"x":0.5,"y":-0.1402009616013139},{"x":0.6,"y":-0.1402009616013139},{"x":0.7,"y":-0.1402009616013139},{"x":0.8,"y":-0.1402009616013139},{"x":0.9,"y":-0.1402009616013139}]},{"name":"6960775f-8813-4701-b0cc-cdd351df39fa","values":[{"x":0,"y":-0.0864253752685594},{"x":0.1,"y":-0.07600792299169445},{"x":0.2,"y":-0.06559047071482953},{"x":0.3,"y":-0.0551730184379646},{"x":0.4,"y":-0.04475556616109966},{"x":0.5,"y":-0.03433811388423473},{"x":0.6,"y":-0.023920661607369803},{"x":0.7,"y":-0.013503209330504876},{"x":0.8,"y":-0.0030857570536399204},{"x":0.9,"y":0.007331695223225007}]},{"name":"c36a9c54-7f8f-40ae-99cb-1105be05b4cb","values":[{"x":0,"y":0.32202772106348676},{"x":0.1,"y":0.30407933524763786},{"x":0.2,"y":0.24481669485018692},{"x":0.3,"y":0.14569014290030413},{"x":0.4,"y":0.008150022427159342},{"x":0.5,"y":-0.16635332354007715},{"x":0.6,"y":-0.3763695519722354},{"x":0.7,"y":-0.6204483198401455},{"x":0.8,"y":-0.8971392841146375},{"x":0.9,"y":-1.2049921017665406}]},{"name":"ef135be3-8527-441a-8a08-71700f262fc4","values":[{"x":0,"y":-0.0644938653578349},{"x":0.1,"y":-0.0465817378905905},{"x":0.2,"y":-0.0286696104233461},{"x":0.3,"y":-0.010757482956101704},{"x":0.4,"y":0.007154644511142699},{"x":0.5,"y":0.025066771978387095},{"x":0.6,"y":0.04297889944563149},{"x":0.7,"y":0.06089102691287589},{"x":0.8,"y":0.0788031543801203},{"x":0.9,"y":0.0967152818473647}]},{"name":"e2f669f9-ed96-4bb8-8fd6-dcd24973fd10","values":[{"x":0,"y":0.0646824293793023},{"x":0.1,"y":0.0646824293793023},{"x":0.2,"y":0.0646824293793023},{"x":0.3,"y":0.0646824293793023},{"x":0.4,"y":0.0646824293793023},{"x":0.5,"y":0.0646824293793023},{"x":0.6,"y":0.0646824293793023},{"x":0.7,"y":0.0646824293793023},{"x":0.8,"y":0.0646824293793023},{"x":0.9,"y":0.0646824293793023}]},{"name":"be6436bd-b7cd-487b-a769-2f2cfb34c1f1","values":[{"x":0,"y":-0.052032950076682974},{"x":0.1,"y":-0.052032950076682974},{"x":0.2,"y":-0.052032950076682974},{"x":0.3,"y":-0.052032950076682974},{"x":0.4,"y":-0.052032950076682974},{"x":0.5,"y":-0.052032950076682974},{"x":0.6,"y":-0.052032950076682974},{"x":0.7,"y":-0.052032950076682974},{"x":0.8,"y":-0.052032950076682974},{"x":0.9,"y":-0.052032950076682974}]},{"name":"f0fe807c-a28f-4434-ab5a-a15dabea672d","values":[{"x":0,"y":-0.023827159498599603},{"x":0.1,"y":-0.019853389892790632},{"x":0.2,"y":-0.013054249387245045},{"x":0.3,"y":-0.003429737981962843},{"x":0.4,"y":0.009020144323055975},{"x":0.5,"y":0.024295397527811406},{"x":0.6,"y":0.04239602163230345},{"x":0.7,"y":0.0633220166365321},{"x":0.8,"y":0.0870733825404974},{"x":0.9,"y":0.11365011934419932}]},{"name":"00f09c1d-6b87-4b14-925c-5a5daa3b9348","values":[{"x":0,"y":-0.18729420842076905},{"x":0.1,"y":-0.22137291536638357},{"x":0.2,"y":-0.2531757744805795},{"x":0.3,"y":-0.27739692460540394},{"x":0.4,"y":-0.28873050458290406},{"x":0.5,"y":-0.28187065325512706},{"x":0.6,"y":-0.25151150946412},{"x":0.7,"y":-0.1923472120519301},{"x":0.8,"y":-0.09907189986060431},{"x":0.9,"y":0.03362028826780994}]},{"name":"1131b590-6ea8-4034-b3a2-72db304ce01b","values":[{"x":0,"y":-0.14586422659157094},{"x":0.1,"y":-0.12524395481029782},{"x":0.2,"y":-0.10462368302902471},{"x":0.3,"y":-0.0840034112477516},{"x":0.4,"y":-0.06338313946647847},{"x":0.5,"y":-0.04276286768520536},{"x":0.6,"y":-0.02214259590393225},{"x":0.7,"y":-0.0015223241226591244},{"x":0.8,"y":0.019097947658614},{"x":0.9,"y":0.0397182194398871}]}],"marks":[{"type":"symbol","from":{"data":"df903a6c-fe04-4e48-820d-b09f2c35bb5c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"2db2e063-7f5d-4bff-9c6b-80a2b1e06b21"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"f8692132-7c03-4338-915d-d2653187adbe"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"01bcadca-8a26-42e9-8311-cf10eaecfef1"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"74b724bd-2aba-4b94-a82b-673bd81b686f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"8dca3714-e541-401d-9961-e98f9e29c14f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"e0326b05-1d96-49a7-8496-74e640afda47"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"b89e400f-8e0f-44e4-8b35-b69d810e069c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"f0c2cf61-d91d-4c02-ac5b-3a2fe7f06ad2"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"d0908fc4-af1d-44d4-9e21-16f02014b841"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"48068814-0c1a-45ba-b055-650100a4dfaa"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"fe5e3145-3568-43f2-ac1a-60ca03c83a79"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"6960775f-8813-4701-b0cc-cdd351df39fa"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"c36a9c54-7f8f-40ae-99cb-1105be05b4cb"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"ef135be3-8527-441a-8a08-71700f262fc4"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"e2f669f9-ed96-4bb8-8fd6-dcd24973fd10"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"be6436bd-b7cd-487b-a769-2f2cfb34c1f1"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"f0fe807c-a28f-4434-ab5a-a15dabea672d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"00f09c1d-6b87-4b14-925c-5a5daa3b9348"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"1131b590-6ea8-4034-b3a2-72db304ce01b"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"df903a6c-fe04-4e48-820d-b09f2c35bb5c\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"df903a6c-fe04-4e48-820d-b09f2c35bb5c\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"df903a6c-fe04-4e48-820d-b09f2c35bb5c\", :values ({:x 0, :y 0} {:x 1/10, :y 1/1000} {:x 1/5, :y 1/125} {:x 3/10, :y 27/1000} {:x 2/5, :y 8/125} {:x 1/2, :y 1/8} {:x 3/5, :y 27/125} {:x 7/10, :y 343/1000} {:x 4/5, :y 64/125} {:x 9/10, :y 729/1000})} {:name \"2db2e063-7f5d-4bff-9c6b-80a2b1e06b21\", :values ({:x 0, :y -0.09094520866899627} {:x 1/10, :y -0.09094520866899627} {:x 1/5, :y -0.09094520866899627} {:x 3/10, :y -0.09094520866899627} {:x 2/5, :y -0.09094520866899627} {:x 1/2, :y -0.09094520866899627} {:x 3/5, :y -0.09094520866899627} {:x 7/10, :y -0.09094520866899627} {:x 4/5, :y -0.09094520866899627} {:x 9/10, :y -0.09094520866899627})} {:name \"f8692132-7c03-4338-915d-d2653187adbe\", :values ({:x 0, :y -0.07309727226111208} {:x 1/10, :y -0.07309727226111208} {:x 1/5, :y -0.07309727226111208} {:x 3/10, :y -0.07309727226111208} {:x 2/5, :y -0.07309727226111208} {:x 1/2, :y -0.07309727226111208} {:x 3/5, :y -0.07309727226111208} {:x 7/10, :y -0.07309727226111208} {:x 4/5, :y -0.07309727226111208} {:x 9/10, :y -0.07309727226111208})} {:name \"01bcadca-8a26-42e9-8311-cf10eaecfef1\", :values ({:x 0, :y -0.14335821644436444} {:x 1/10, :y -0.20895243922206663} {:x 1/5, :y -0.2584064874144555} {:x 3/10, :y -0.30127697010669313} {:x 2/5, :y -0.3471204963839416} {:x 1/2, :y -0.4054936753313628} {:x 3/5, :y -0.48595311603411895} {:x 7/10, :y -0.598055427577372} {:x 4/5, :y -0.7513572190462844} {:x 9/10, :y -0.9554150995260174})} {:name \"74b724bd-2aba-4b94-a82b-673bd81b686f\", :values ({:x 0, :y -0.5216455172522331} {:x 1/10, :y -0.48634994625440103} {:x 1/5, :y -0.4216318142707154} {:x 3/10, :y -0.3274911213011763} {:x 2/5, :y -0.20392786734578355} {:x 1/2, :y -0.050942052404537363} {:x 3/5, :y 0.13146632352256238} {:x 7/10, :y 0.34329726043551556} {:x 4/5, :y 0.5845507583343227} {:x 9/10, :y 0.8552268172189831})} {:name \"8dca3714-e541-401d-9961-e98f9e29c14f\", :values ({:x 0, :y -0.013909740251715867} {:x 1/10, :y -0.013909740251715867} {:x 1/5, :y -0.013909740251715867} {:x 3/10, :y -0.013909740251715867} {:x 2/5, :y -0.013909740251715867} {:x 1/2, :y -0.013909740251715867} {:x 3/5, :y -0.013909740251715867} {:x 7/10, :y -0.013909740251715867} {:x 4/5, :y -0.013909740251715867} {:x 9/10, :y -0.013909740251715867})} {:name \"e0326b05-1d96-49a7-8496-74e640afda47\", :values ({:x 0, :y 0.07279110369164145} {:x 1/10, :y 0.07388335858585142} {:x 1/5, :y 0.07452639485806092} {:x 3/10, :y 0.07472021250826995} {:x 2/5, :y 0.0744648115364785} {:x 1/2, :y 0.0737601919426866} {:x 3/5, :y 0.07260635372689421} {:x 7/10, :y 0.07100329688910136} {:x 4/5, :y 0.06895102142930803} {:x 9/10, :y 0.06644952734751423})} {:name \"b89e400f-8e0f-44e4-8b35-b69d810e069c\", :values ({:x 0, :y 0.23917938394091387} {:x 1/10, :y 0.23917938394091387} {:x 1/5, :y 0.23917938394091387} {:x 3/10, :y 0.23917938394091387} {:x 2/5, :y 0.23917938394091387} {:x 1/2, :y 0.23917938394091387} {:x 3/5, :y 0.23917938394091387} {:x 7/10, :y 0.23917938394091387} {:x 4/5, :y 0.23917938394091387} {:x 9/10, :y 0.23917938394091387})} {:name \"f0c2cf61-d91d-4c02-ac5b-3a2fe7f06ad2\", :values ({:x 0, :y -0.0493522298231436} {:x 1/10, :y -0.0493522298231436} {:x 1/5, :y -0.0493522298231436} {:x 3/10, :y -0.0493522298231436} {:x 2/5, :y -0.0493522298231436} {:x 1/2, :y -0.0493522298231436} {:x 3/5, :y -0.0493522298231436} {:x 7/10, :y -0.0493522298231436} {:x 4/5, :y -0.0493522298231436} {:x 9/10, :y -0.0493522298231436})} {:name \"d0908fc4-af1d-44d4-9e21-16f02014b841\", :values ({:x 0, :y -0.03548236041325674} {:x 1/10, :y -0.022783928190101103} {:x 1/5, :y -0.00788870191207322} {:x 3/10, :y 0.015322193907946431} {:x 2/5, :y 0.05497244822456891} {:x 1/2, :y 0.12119056345989666} {:x 3/5, :y 0.22610985550352358} {:x 7/10, :y 0.3838684537125355} {:x 4/5, :y 0.6106093009115091} {:x 9/10, :y 0.9244801533925128})} {:name \"48068814-0c1a-45ba-b055-650100a4dfaa\", :values ({:x 0, :y 0.011786763575410572} {:x 1/10, :y 0.06933195742475283} {:x 1/5, :y 0.1268771512740951} {:x 3/10, :y 0.18442234512343736} {:x 2/5, :y 0.24196753897277962} {:x 1/2, :y 0.2995127328221219} {:x 3/5, :y 0.35705792667146413} {:x 7/10, :y 0.4146031205208064} {:x 4/5, :y 0.47214831437014865} {:x 9/10, :y 0.5296935082194909})} {:name \"fe5e3145-3568-43f2-ac1a-60ca03c83a79\", :values ({:x 0, :y -0.1402009616013139} {:x 1/10, :y -0.1402009616013139} {:x 1/5, :y -0.1402009616013139} {:x 3/10, :y -0.1402009616013139} {:x 2/5, :y -0.1402009616013139} {:x 1/2, :y -0.1402009616013139} {:x 3/5, :y -0.1402009616013139} {:x 7/10, :y -0.1402009616013139} {:x 4/5, :y -0.1402009616013139} {:x 9/10, :y -0.1402009616013139})} {:name \"6960775f-8813-4701-b0cc-cdd351df39fa\", :values ({:x 0, :y -0.0864253752685594} {:x 1/10, :y -0.07600792299169445} {:x 1/5, :y -0.06559047071482953} {:x 3/10, :y -0.0551730184379646} {:x 2/5, :y -0.04475556616109966} {:x 1/2, :y -0.03433811388423473} {:x 3/5, :y -0.023920661607369803} {:x 7/10, :y -0.013503209330504876} {:x 4/5, :y -0.0030857570536399204} {:x 9/10, :y 0.007331695223225007})} {:name \"c36a9c54-7f8f-40ae-99cb-1105be05b4cb\", :values ({:x 0, :y 0.32202772106348676} {:x 1/10, :y 0.30407933524763786} {:x 1/5, :y 0.24481669485018692} {:x 3/10, :y 0.14569014290030413} {:x 2/5, :y 0.008150022427159342} {:x 1/2, :y -0.16635332354007715} {:x 3/5, :y -0.3763695519722354} {:x 7/10, :y -0.6204483198401455} {:x 4/5, :y -0.8971392841146375} {:x 9/10, :y -1.2049921017665406})} {:name \"ef135be3-8527-441a-8a08-71700f262fc4\", :values ({:x 0, :y -0.0644938653578349} {:x 1/10, :y -0.0465817378905905} {:x 1/5, :y -0.0286696104233461} {:x 3/10, :y -0.010757482956101704} {:x 2/5, :y 0.007154644511142699} {:x 1/2, :y 0.025066771978387095} {:x 3/5, :y 0.04297889944563149} {:x 7/10, :y 0.06089102691287589} {:x 4/5, :y 0.0788031543801203} {:x 9/10, :y 0.0967152818473647})} {:name \"e2f669f9-ed96-4bb8-8fd6-dcd24973fd10\", :values ({:x 0, :y 0.0646824293793023} {:x 1/10, :y 0.0646824293793023} {:x 1/5, :y 0.0646824293793023} {:x 3/10, :y 0.0646824293793023} {:x 2/5, :y 0.0646824293793023} {:x 1/2, :y 0.0646824293793023} {:x 3/5, :y 0.0646824293793023} {:x 7/10, :y 0.0646824293793023} {:x 4/5, :y 0.0646824293793023} {:x 9/10, :y 0.0646824293793023})} {:name \"be6436bd-b7cd-487b-a769-2f2cfb34c1f1\", :values ({:x 0, :y -0.052032950076682974} {:x 1/10, :y -0.052032950076682974} {:x 1/5, :y -0.052032950076682974} {:x 3/10, :y -0.052032950076682974} {:x 2/5, :y -0.052032950076682974} {:x 1/2, :y -0.052032950076682974} {:x 3/5, :y -0.052032950076682974} {:x 7/10, :y -0.052032950076682974} {:x 4/5, :y -0.052032950076682974} {:x 9/10, :y -0.052032950076682974})} {:name \"f0fe807c-a28f-4434-ab5a-a15dabea672d\", :values ({:x 0, :y -0.023827159498599603} {:x 1/10, :y -0.019853389892790632} {:x 1/5, :y -0.013054249387245045} {:x 3/10, :y -0.003429737981962843} {:x 2/5, :y 0.009020144323055975} {:x 1/2, :y 0.024295397527811406} {:x 3/5, :y 0.04239602163230345} {:x 7/10, :y 0.0633220166365321} {:x 4/5, :y 0.0870733825404974} {:x 9/10, :y 0.11365011934419932})} {:name \"00f09c1d-6b87-4b14-925c-5a5daa3b9348\", :values ({:x 0, :y -0.18729420842076905} {:x 1/10, :y -0.22137291536638357} {:x 1/5, :y -0.2531757744805795} {:x 3/10, :y -0.27739692460540394} {:x 2/5, :y -0.28873050458290406} {:x 1/2, :y -0.28187065325512706} {:x 3/5, :y -0.25151150946412} {:x 7/10, :y -0.1923472120519301} {:x 4/5, :y -0.09907189986060431} {:x 9/10, :y 0.03362028826780994})} {:name \"1131b590-6ea8-4034-b3a2-72db304ce01b\", :values ({:x 0, :y -0.14586422659157094} {:x 1/10, :y -0.12524395481029782} {:x 1/5, :y -0.10462368302902471} {:x 3/10, :y -0.0840034112477516} {:x 2/5, :y -0.06338313946647847} {:x 1/2, :y -0.04276286768520536} {:x 3/5, :y -0.02214259590393225} {:x 7/10, :y -0.0015223241226591244} {:x 4/5, :y 0.019097947658614} {:x 9/10, :y 0.0397182194398871})}), :marks ({:type \"symbol\", :from {:data \"df903a6c-fe04-4e48-820d-b09f2c35bb5c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"2db2e063-7f5d-4bff-9c6b-80a2b1e06b21\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"f8692132-7c03-4338-915d-d2653187adbe\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"01bcadca-8a26-42e9-8311-cf10eaecfef1\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"74b724bd-2aba-4b94-a82b-673bd81b686f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"8dca3714-e541-401d-9961-e98f9e29c14f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"e0326b05-1d96-49a7-8496-74e640afda47\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"b89e400f-8e0f-44e4-8b35-b69d810e069c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"f0c2cf61-d91d-4c02-ac5b-3a2fe7f06ad2\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"d0908fc4-af1d-44d4-9e21-16f02014b841\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"48068814-0c1a-45ba-b055-650100a4dfaa\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"fe5e3145-3568-43f2-ac1a-60ca03c83a79\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"6960775f-8813-4701-b0cc-cdd351df39fa\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"c36a9c54-7f8f-40ae-99cb-1105be05b4cb\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"ef135be3-8527-441a-8a08-71700f262fc4\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"e2f669f9-ed96-4bb8-8fd6-dcd24973fd10\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"be6436bd-b7cd-487b-a769-2f2cfb34c1f1\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"f0fe807c-a28f-4434-ab5a-a15dabea672d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"00f09c1d-6b87-4b14-925c-5a5daa3b9348\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"1131b590-6ea8-4034-b3a2-72db304ce01b\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(let [inputs (into [] (map #(/ % 10) (range 10)))
      weights [0 0 0 1]
      outputs (map #(poly weights %) inputs)
      other-weights (map :result (take 10 (drop 1000 (infer :rmh polynomial-regression-basic [inputs outputs]))))
      prediction-plots (map (fn [W] (list-plot (map #(poly W %) inputs) :joined true)) other-weights)]
  (apply compose (cons (list-plot outputs) prediction-plots))
  )
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"103089c3-bd0c-433a-ba1e-8efeb10749c7","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"103089c3-bd0c-433a-ba1e-8efeb10749c7","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"103089c3-bd0c-433a-ba1e-8efeb10749c7","values":[{"x":0,"y":0},{"x":1,"y":0.001},{"x":2,"y":0.008},{"x":3,"y":0.027},{"x":4,"y":0.064},{"x":5,"y":0.125},{"x":6,"y":0.216},{"x":7,"y":0.343},{"x":8,"y":0.512},{"x":9,"y":0.729}]},{"name":"055fea8c-a2a5-44a3-a86c-fcc6460239c8","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05607524862783651},{"x":2,"y":-0.025795894947321048},{"x":3,"y":0.014672301868459858},{"x":4,"y":0.06532934181950621},{"x":5,"y":0.126175224905818},{"x":6,"y":0.1972099511273952},{"x":7,"y":0.27843352048423786},{"x":8,"y":0.36984593297634605},{"x":9,"y":0.4714471886037196}]},{"name":"d0224eb1-535c-4f4e-b0ca-eb91cdf13336","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05607524862783651},{"x":2,"y":-0.025795894947321048},{"x":3,"y":0.014672301868459858},{"x":4,"y":0.06532934181950621},{"x":5,"y":0.126175224905818},{"x":6,"y":0.1972099511273952},{"x":7,"y":0.27843352048423786},{"x":8,"y":0.36984593297634605},{"x":9,"y":0.4714471886037196}]},{"name":"3609b0ce-372d-42a8-9e7a-297c3ea6842e","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05607524862783651},{"x":2,"y":-0.025795894947321048},{"x":3,"y":0.014672301868459858},{"x":4,"y":0.06532934181950621},{"x":5,"y":0.126175224905818},{"x":6,"y":0.1972099511273952},{"x":7,"y":0.27843352048423786},{"x":8,"y":0.36984593297634605},{"x":9,"y":0.4714471886037196}]},{"name":"171d16e2-589d-40bb-a0c5-9fbb90dd5c2c","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05607524862783651},{"x":2,"y":-0.025795894947321048},{"x":3,"y":0.014672301868459858},{"x":4,"y":0.06532934181950621},{"x":5,"y":0.126175224905818},{"x":6,"y":0.1972099511273952},{"x":7,"y":0.27843352048423786},{"x":8,"y":0.36984593297634605},{"x":9,"y":0.4714471886037196}]},{"name":"839c3afa-4c4c-4a4c-afd2-297fe8d03bf1","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05607524862783651},{"x":2,"y":-0.025795894947321048},{"x":3,"y":0.014672301868459858},{"x":4,"y":0.06532934181950621},{"x":5,"y":0.126175224905818},{"x":6,"y":0.1972099511273952},{"x":7,"y":0.27843352048423786},{"x":8,"y":0.36984593297634605},{"x":9,"y":0.4714471886037196}]},{"name":"cfd5a5d8-156c-4120-928d-a4c2978de07c","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05607524862783651},{"x":2,"y":-0.025795894947321048},{"x":3,"y":0.014672301868459858},{"x":4,"y":0.06532934181950621},{"x":5,"y":0.126175224905818},{"x":6,"y":0.1972099511273952},{"x":7,"y":0.27843352048423786},{"x":8,"y":0.36984593297634605},{"x":9,"y":0.4714471886037196}]},{"name":"be7517b8-9bba-4c19-b2a8-84eb070fb44f","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05508981032719765},{"x":2,"y":-0.02185414174476559},{"x":3,"y":0.023541246574209626},{"x":4,"y":0.08109635462972804},{"x":5,"y":0.1508111824217896},{"x":6,"y":0.23268572995039427},{"x":7,"y":0.3267199972155422},{"x":8,"y":0.43291398421723326},{"x":9,"y":0.5512676909554675}]},{"name":"7120b604-5e20-4c6f-be11-b634bb1abb0f","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05508981032719765},{"x":2,"y":-0.02185414174476559},{"x":3,"y":0.023541246574209626},{"x":4,"y":0.08109635462972804},{"x":5,"y":0.1508111824217896},{"x":6,"y":0.23268572995039427},{"x":7,"y":0.3267199972155422},{"x":8,"y":0.43291398421723326},{"x":9,"y":0.5512676909554675}]},{"name":"6164eb7d-5dd0-4fd9-8fbb-7e9effcd5be5","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05508981032719765},{"x":2,"y":-0.02185414174476559},{"x":3,"y":0.023541246574209626},{"x":4,"y":0.08109635462972804},{"x":5,"y":0.1508111824217896},{"x":6,"y":0.23268572995039427},{"x":7,"y":0.3267199972155422},{"x":8,"y":0.43291398421723326},{"x":9,"y":0.5512676909554675}]},{"name":"15539444-2aba-4b5a-b003-bb9ed787511c","values":[{"x":0,"y":-0.07616575917308653},{"x":1,"y":-0.05508981032719765},{"x":2,"y":-0.02185414174476559},{"x":3,"y":0.023541246574209626},{"x":4,"y":0.08109635462972804},{"x":5,"y":0.1508111824217896},{"x":6,"y":0.23268572995039427},{"x":7,"y":0.3267199972155422},{"x":8,"y":0.43291398421723326},{"x":9,"y":0.5512676909554675}]}],"marks":[{"type":"symbol","from":{"data":"103089c3-bd0c-433a-ba1e-8efeb10749c7"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"055fea8c-a2a5-44a3-a86c-fcc6460239c8"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"d0224eb1-535c-4f4e-b0ca-eb91cdf13336"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"3609b0ce-372d-42a8-9e7a-297c3ea6842e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"171d16e2-589d-40bb-a0c5-9fbb90dd5c2c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"839c3afa-4c4c-4a4c-afd2-297fe8d03bf1"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"cfd5a5d8-156c-4120-928d-a4c2978de07c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"be7517b8-9bba-4c19-b2a8-84eb070fb44f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"7120b604-5e20-4c6f-be11-b634bb1abb0f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"6164eb7d-5dd0-4fd9-8fbb-7e9effcd5be5"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"15539444-2aba-4b5a-b003-bb9ed787511c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"103089c3-bd0c-433a-ba1e-8efeb10749c7\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"103089c3-bd0c-433a-ba1e-8efeb10749c7\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"103089c3-bd0c-433a-ba1e-8efeb10749c7\", :values ({:x 0, :y 0} {:x 1, :y 1/1000} {:x 2, :y 1/125} {:x 3, :y 27/1000} {:x 4, :y 8/125} {:x 5, :y 1/8} {:x 6, :y 27/125} {:x 7, :y 343/1000} {:x 8, :y 64/125} {:x 9, :y 729/1000})} {:name \"055fea8c-a2a5-44a3-a86c-fcc6460239c8\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05607524862783651} {:x 2, :y -0.025795894947321048} {:x 3, :y 0.014672301868459858} {:x 4, :y 0.06532934181950621} {:x 5, :y 0.126175224905818} {:x 6, :y 0.1972099511273952} {:x 7, :y 0.27843352048423786} {:x 8, :y 0.36984593297634605} {:x 9, :y 0.4714471886037196})} {:name \"d0224eb1-535c-4f4e-b0ca-eb91cdf13336\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05607524862783651} {:x 2, :y -0.025795894947321048} {:x 3, :y 0.014672301868459858} {:x 4, :y 0.06532934181950621} {:x 5, :y 0.126175224905818} {:x 6, :y 0.1972099511273952} {:x 7, :y 0.27843352048423786} {:x 8, :y 0.36984593297634605} {:x 9, :y 0.4714471886037196})} {:name \"3609b0ce-372d-42a8-9e7a-297c3ea6842e\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05607524862783651} {:x 2, :y -0.025795894947321048} {:x 3, :y 0.014672301868459858} {:x 4, :y 0.06532934181950621} {:x 5, :y 0.126175224905818} {:x 6, :y 0.1972099511273952} {:x 7, :y 0.27843352048423786} {:x 8, :y 0.36984593297634605} {:x 9, :y 0.4714471886037196})} {:name \"171d16e2-589d-40bb-a0c5-9fbb90dd5c2c\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05607524862783651} {:x 2, :y -0.025795894947321048} {:x 3, :y 0.014672301868459858} {:x 4, :y 0.06532934181950621} {:x 5, :y 0.126175224905818} {:x 6, :y 0.1972099511273952} {:x 7, :y 0.27843352048423786} {:x 8, :y 0.36984593297634605} {:x 9, :y 0.4714471886037196})} {:name \"839c3afa-4c4c-4a4c-afd2-297fe8d03bf1\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05607524862783651} {:x 2, :y -0.025795894947321048} {:x 3, :y 0.014672301868459858} {:x 4, :y 0.06532934181950621} {:x 5, :y 0.126175224905818} {:x 6, :y 0.1972099511273952} {:x 7, :y 0.27843352048423786} {:x 8, :y 0.36984593297634605} {:x 9, :y 0.4714471886037196})} {:name \"cfd5a5d8-156c-4120-928d-a4c2978de07c\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05607524862783651} {:x 2, :y -0.025795894947321048} {:x 3, :y 0.014672301868459858} {:x 4, :y 0.06532934181950621} {:x 5, :y 0.126175224905818} {:x 6, :y 0.1972099511273952} {:x 7, :y 0.27843352048423786} {:x 8, :y 0.36984593297634605} {:x 9, :y 0.4714471886037196})} {:name \"be7517b8-9bba-4c19-b2a8-84eb070fb44f\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05508981032719765} {:x 2, :y -0.02185414174476559} {:x 3, :y 0.023541246574209626} {:x 4, :y 0.08109635462972804} {:x 5, :y 0.1508111824217896} {:x 6, :y 0.23268572995039427} {:x 7, :y 0.3267199972155422} {:x 8, :y 0.43291398421723326} {:x 9, :y 0.5512676909554675})} {:name \"7120b604-5e20-4c6f-be11-b634bb1abb0f\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05508981032719765} {:x 2, :y -0.02185414174476559} {:x 3, :y 0.023541246574209626} {:x 4, :y 0.08109635462972804} {:x 5, :y 0.1508111824217896} {:x 6, :y 0.23268572995039427} {:x 7, :y 0.3267199972155422} {:x 8, :y 0.43291398421723326} {:x 9, :y 0.5512676909554675})} {:name \"6164eb7d-5dd0-4fd9-8fbb-7e9effcd5be5\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05508981032719765} {:x 2, :y -0.02185414174476559} {:x 3, :y 0.023541246574209626} {:x 4, :y 0.08109635462972804} {:x 5, :y 0.1508111824217896} {:x 6, :y 0.23268572995039427} {:x 7, :y 0.3267199972155422} {:x 8, :y 0.43291398421723326} {:x 9, :y 0.5512676909554675})} {:name \"15539444-2aba-4b5a-b003-bb9ed787511c\", :values ({:x 0, :y -0.07616575917308653} {:x 1, :y -0.05508981032719765} {:x 2, :y -0.02185414174476559} {:x 3, :y 0.023541246574209626} {:x 4, :y 0.08109635462972804} {:x 5, :y 0.1508111824217896} {:x 6, :y 0.23268572995039427} {:x 7, :y 0.3267199972155422} {:x 8, :y 0.43291398421723326} {:x 9, :y 0.5512676909554675})}), :marks ({:type \"symbol\", :from {:data \"103089c3-bd0c-433a-ba1e-8efeb10749c7\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"055fea8c-a2a5-44a3-a86c-fcc6460239c8\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"d0224eb1-535c-4f4e-b0ca-eb91cdf13336\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"3609b0ce-372d-42a8-9e7a-297c3ea6842e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"171d16e2-589d-40bb-a0c5-9fbb90dd5c2c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"839c3afa-4c4c-4a4c-afd2-297fe8d03bf1\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"cfd5a5d8-156c-4120-928d-a4c2978de07c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"be7517b8-9bba-4c19-b2a8-84eb070fb44f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"7120b604-5e20-4c6f-be11-b634bb1abb0f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"6164eb7d-5dd0-4fd9-8fbb-7e9effcd5be5\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"15539444-2aba-4b5a-b003-bb9ed787511c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(let [dataset-no 3
      particle-range [10 20 40 80 160 320 640 1280 2560]]
  (map #(print-inference-results % "csis" dataset-no) particle-range))
;; @@

;; **
;;; Plot the results:
;; **

;; @@
(let [x [1 2 3 4 5 6 7 8 9 10]
      y (into [] (map #(poly [1 1 1] %) x))]
  (println x y))
;; @@
;; ->
;;; [1 2 3 4 5 6 7 8 9 10] [3 7 13 21 31 43 57 73 91 111]
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
;(let [ dataset 1
;       weights [1 -1]
;       inputs (map #(float (/ % 10)) (range -9 10 3))
;       observation-string (str/join "," (map #(sample* (student-t-loc-scale 4 (poly weights %) 0.1)) inputs))
;       input-string (str/join "," inputs)
;       weight-string (str/join "," weights)
;       file-contents (str/join "\n" [weight-string input-string observation-string])]
;  (spit (str "plots/polynomial-regression-variable-input-size/data_" dataset "_test.csv") file-contents))

;; @@

;; @@

;; @@
